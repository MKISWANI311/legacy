!function(t){var e={};function a(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(s,n,function(e){return t[e]}.bind(null,n));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=7)}([function(t,e,a){"use strict";var s=a(2),n=new function(){var t=this;this.data={};var e=null,a=null,n={ks:256,ts:128,mode:"ccm",cipher:"aes"};this.subscribers=[],this.RequestPass=null;var i={},o={};this.set=function(t,e,a){a?localStorage.setItem(t,e):this.data[t]=e},this.get=function(t,e){return this.data[t]||localStorage.getItem(t)||e},this.calcHash=function(t){return s.codec.hex.fromBits(s.hash.sha256.hash(t))},this.hasHash=function(){return null!=a&&""!=a},this.hasPass=function(){return null!==e&&""!==e},this.checkPass=function(t){return!(!this.hasHash()||!t)&&a===this.calcHash(t)},this.setPassHash=function(t){return!!t&&(a=t)},this.setPass=function(s){if(!s)return!1;for(var n in e=s,this.hasHash()||this.setPassHash(this.calcHash(s)),this.subscribers)t.subscribers[n].EventOpen&&t.subscribers[n].EventOpen instanceof Function&&t.subscribers[n].EventOpen();return a},this.expirePass=function(){for(var a in t.subscribers)"function"==typeof t.subscribers[a].EventClose&&t.subscribers[a].EventClose();e=null,i={},o={},t.RequestPass&&t.RequestPass instanceof Function&&t.RequestPass.call()},this.encode=function(t,a){if(e&&!1!==t&&null!==t){if(a&&i[t])return i[t];try{var d=s.encrypt(e,t,n);return a&&(i[t]=d,o[d]=t),d}catch(t){}}return!1},this.decode=function(t,a){if(e&&t){if(a&&o[t])return o[t];try{var n=s.decrypt(e,t);return a&&(o[t]=n,i[n]=t),n}catch(t){}}return!1},this.subscribe=function(t){this.subscribers.push(t)}};t.exports=n},function(t,e,a){"use strict";var s={server:localStorage.getItem("server")||"https://fortnotes.com/",mode:"cors",credentials:"include",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}};function n(t){return t.status>=200&&t.status<300?Promise.resolve(t):Promise.reject(new Error(t.statusText))}function i(t){return t.json()}t.exports={defaults:s,get:function(t,e){fetch(s.server+t,s).then(n).then(i).then(function(t){e(null,t)}).catch(e)},post:function(t,e,a){fetch(s.server+t,Object.assign({},s,{method:"post",body:JSON.stringify(e)})).then(n).then(i).then(function(t){a(null,t)}).catch(a)},postForm:function(t,e,a){var o=Object.assign({},s,{method:"post",body:e,headers:{Accept:"application/json"}});fetch(s.server+t,o).then(n).then(i).then(function(t){a(null,t)}).catch(a)}}},function(t,e,a){"use strict";var s={cipher:{},hash:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t}}};s.cipher.aes=function(t){this.h[0][0][0]||this.w();var e,a,n,i,o=this.h[0][4],d=this.h[1],r=1;if(4!==(e=t.length)&&6!==e&&8!==e)throw new s.exception.invalid("invalid aes key size");for(this.a=[n=t.slice(0),i=[]],t=e;t<4*e+28;t++)a=n[t-1],(t%e==0||8===e&&t%e==4)&&(a=o[a>>>24]<<24^o[a>>16&255]<<16^o[a>>8&255]<<8^o[255&a],t%e==0&&(a=a<<8^a>>>24^r<<24,r=r<<1^283*(r>>7))),n[t]=n[t-e]^a;for(e=0;t;e++,t--)a=n[3&e?t:t-4],i[e]=t<=4||e<4?a:d[0][o[a>>>24]]^d[1][o[a>>16&255]]^d[2][o[a>>8&255]]^d[3][o[255&a]]},s.cipher.aes.prototype={encrypt:function(t){return this.H(t,0)},decrypt:function(t){return this.H(t,1)},h:[[[],[],[],[],[]],[[],[],[],[],[]]],w:function(){var t,e,a,s,n,i,o,d=this.h[0],r=this.h[1],l=d[4],c=r[4],h=[],m=[];for(t=0;t<256;t++)m[(h[t]=t<<1^283*(t>>7))^t]=t;for(e=a=0;!l[e];e^=s||1,a=m[a]||1)for(i=(i=a^a<<1^a<<2^a<<3^a<<4)>>8^255&i^99,l[e]=i,c[i]=e,o=16843009*(n=h[t=h[s=h[e]]])^65537*t^257*s^16843008*e,n=257*h[i]^16843008*i,t=0;t<4;t++)d[t][e]=n=n<<24^n>>>8,r[t][i]=o=o<<24^o>>>8;for(t=0;t<5;t++)d[t]=d[t].slice(0),r[t]=r[t].slice(0)},H:function(t,e){if(4!==t.length)throw new s.exception.invalid("invalid aes block size");var a=this.a[e],n=t[0]^a[0],i=t[e?3:1]^a[1],o=t[2]^a[2];t=t[e?1:3]^a[3];var d,r,l,c,h=a.length/4-2,m=4,u=[0,0,0,0],p=(d=this.h[e])[0],f=d[1],g=d[2],v=d[3],y=d[4];for(c=0;c<h;c++)d=p[n>>>24]^f[i>>16&255]^g[o>>8&255]^v[255&t]^a[m],r=p[i>>>24]^f[o>>16&255]^g[t>>8&255]^v[255&n]^a[m+1],l=p[o>>>24]^f[t>>16&255]^g[n>>8&255]^v[255&i]^a[m+2],t=p[t>>>24]^f[n>>16&255]^g[i>>8&255]^v[255&o]^a[m+3],m+=4,n=d,i=r,o=l;for(c=0;c<4;c++)u[e?3&-c:c]=y[n>>>24]<<24^y[i>>16&255]<<16^y[o>>8&255]<<8^y[255&t]^a[m++],d=n,n=i,i=o,o=t,t=d;return u}},s.bitArray={bitSlice:function(t,e,a){return t=s.bitArray.P(t.slice(e/32),32-(31&e)).slice(1),void 0===a?t:s.bitArray.clamp(t,a-e)},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var a=t[t.length-1],n=s.bitArray.getPartial(a);return 32===n?t.concat(e):s.bitArray.P(e,n,0|a,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return 0===e?0:32*(e-1)+s.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;var a=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,a>0&&e&&(t[a-1]=s.bitArray.partial(e,t[a-1]&2147483648>>e-1,1)),t},partial:function(t,e,a){return 32===t?e:(a?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(s.bitArray.bitLength(t)!==s.bitArray.bitLength(e))return!1;var a,n=0;for(a=0;a<t.length;a++)n|=t[a]^e[a];return 0===n},P:function(t,e,a,n){var i;for(i=0,void 0===n&&(n=[]);e>=32;e-=32)n.push(a),a=0;if(0===e)return n.concat(t);for(i=0;i<t.length;i++)n.push(a|t[i]>>>e),a=t[i]<<32-e;return i=t.length?t[t.length-1]:0,t=s.bitArray.getPartial(i),n.push(s.bitArray.partial(e+t&31,e+t>32?a:n.pop(),1)),n},k:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},s.codec.utf8String={fromBits:function(t){var e,a,n="",i=s.bitArray.bitLength(t);for(e=0;e<i/8;e++)0==(3&e)&&(a=t[e/4]),n+=String.fromCharCode(a>>>24),a<<=8;return decodeURIComponent(escape(n))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,a=[],n=0;for(e=0;e<t.length;e++)n=n<<8|t.charCodeAt(e),3==(3&e)&&(a.push(n),n=0);return 3&e&&a.push(s.bitArray.partial(8*(3&e),n)),a}},s.codec.hex={fromBits:function(t){var e,a="";for(e=0;e<t.length;e++)a+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return a.substr(0,s.bitArray.bitLength(t)/4)},toBits:function(t){var e,a,n=[];for(a=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)n.push(0^parseInt(t.substr(e,8),16));return s.bitArray.clamp(n,4*a)}},s.codec.base64={D:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e){var a,n="",i=0,o=s.codec.base64.D,d=0,r=s.bitArray.bitLength(t);for(a=0;6*n.length<r;)n+=o.charAt((d^t[a]>>>i)>>>26),i<6?(d=t[a]<<6-i,i+=26,a++):(d<<=6,i-=6);for(;3&n.length&&!e;)n+="=";return n},toBits:function(t){t=t.replace(/\s|=/g,"");var e,a,n=[],i=0,o=s.codec.base64.D,d=0;for(e=0;e<t.length;e++){if((a=o.indexOf(t.charAt(e)))<0)throw new s.exception.invalid("this isn't base64!");i>26?(i-=26,n.push(d^a>>>i),d=a<<32-i):d^=a<<32-(i+=6)}return 56&i&&n.push(s.bitArray.partial(56&i,d,1)),n}},s.hash.sha256=function(t){this.a[0]||this.w(),t?(this.n=t.n.slice(0),this.i=t.i.slice(0),this.e=t.e):this.reset()},s.hash.sha256.hash=function(t){return(new s.hash.sha256).update(t).finalize()},s.hash.sha256.prototype={blockSize:512,reset:function(){return this.n=this.N.slice(0),this.i=[],this.e=0,this},update:function(t){"string"==typeof t&&(t=s.codec.utf8String.toBits(t));var e,a=this.i=s.bitArray.concat(this.i,t);for(e=this.e,t=this.e=e+s.bitArray.bitLength(t),e=512+e&-512;e<=t;e+=512)this.C(a.splice(0,16));return this},finalize:function(){var t,e=this.i,a=this.n;for(t=(e=s.bitArray.concat(e,[s.bitArray.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this.e/4294967296)),e.push(0|this.e);e.length;)this.C(e.splice(0,16));return this.reset(),a},N:[],a:[],w:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,a=0,s=2;t:for(;a<64;s++){for(e=2;e*e<=s;e++)if(s%e==0)continue t;a<8&&(this.N[a]=t(Math.pow(s,.5))),this.a[a]=t(Math.pow(s,1/3)),a++}},C:function(t){var e,a,s=t.slice(0),n=this.n,i=this.a,o=n[0],d=n[1],r=n[2],l=n[3],c=n[4],h=n[5],m=n[6],u=n[7];for(t=0;t<64;t++)t<16?e=s[t]:(e=s[t+1&15],a=s[t+14&15],e=s[15&t]=(e>>>7^e>>>18^e>>>3^e<<25^e<<14)+(a>>>17^a>>>19^a>>>10^a<<15^a<<13)+s[15&t]+s[t+9&15]|0),e=e+u+(c>>>6^c>>>11^c>>>25^c<<26^c<<21^c<<7)+(m^c&(h^m))+i[t],u=m,m=h,h=c,c=l+e|0,l=r,r=d,o=e+((d=o)&r^l&(d^r))+(d>>>2^d>>>13^d>>>22^d<<30^d<<19^d<<10)|0;n[0]=n[0]+o|0,n[1]=n[1]+d|0,n[2]=n[2]+r|0,n[3]=n[3]+l|0,n[4]=n[4]+c|0,n[5]=n[5]+h|0,n[6]=n[6]+m|0,n[7]=n[7]+u|0}},s.mode.ccm={name:"ccm",encrypt:function(t,e,a,n,i){var o,d=e.slice(0),r=s.bitArray,l=r.bitLength(a)/8,c=r.bitLength(d)/8;if(i=i||64,n=n||[],l<7)throw new s.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;o<4&&c>>>8*o;o++);return o<15-l&&(o=15-l),a=r.clamp(a,8*(15-o)),e=s.mode.ccm.G(t,e,a,n,i,o),d=s.mode.ccm.I(t,d,a,e,i,o),r.concat(d.data,d.tag)},decrypt:function(t,e,a,n,i){i=i||64,n=n||[];var o=s.bitArray,d=o.bitLength(a)/8,r=o.bitLength(e),l=o.clamp(e,r-i),c=o.bitSlice(e,r-i);if(r=(r-i)/8,d<7)throw new s.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;e<4&&r>>>8*e;e++);if(e<15-d&&(e=15-d),a=o.clamp(a,8*(15-e)),l=s.mode.ccm.I(t,l,a,c,i,e),t=s.mode.ccm.G(t,l.data,a,n,i,e),!o.equal(l.tag,t))throw new s.exception.corrupt("ccm: tag doesn't match");return l.data},G:function(t,e,a,n,i,o){var d=[],r=s.bitArray,l=r.k;if((i/=8)%2||i<4||i>16)throw new s.exception.invalid("ccm: invalid tag length");if(n.length>4294967295||e.length>4294967295)throw new s.exception.bug("ccm: can't deal with 4GiB or more data");if(o=[r.partial(8,(n.length?64:0)|i-2<<2|o-1)],(o=r.concat(o,a))[3]|=r.bitLength(e)/8,o=t.encrypt(o),n.length)for((a=r.bitLength(n)/8)<=65279?d=[r.partial(16,a)]:a<=4294967295&&(d=r.concat([r.partial(16,65534)],[a])),d=r.concat(d,n),n=0;n<d.length;n+=4)o=t.encrypt(l(o,d.slice(n,n+4)));for(n=0;n<e.length;n+=4)o=t.encrypt(l(o,e.slice(n,n+4)));return r.clamp(o,8*i)},I:function(t,e,a,n,i,o){var d,r=s.bitArray;d=r.k;var l=e.length,c=r.bitLength(e);if(a=r.concat([r.partial(8,o-1)],a).concat([0,0,0]).slice(0,4),n=r.bitSlice(d(n,t.encrypt(a)),0,i),!l)return{tag:n,data:[]};for(d=0;d<l;d+=4)a[3]++,i=t.encrypt(a),e[d]^=i[0],e[d+1]^=i[1],e[d+2]^=i[2],e[d+3]^=i[3];return{tag:n,data:r.clamp(e,c)}}},s.mode.ocb2={name:"ocb2",encrypt:function(t,e,a,n,i,o){if(128!==s.bitArray.bitLength(a))throw new s.exception.invalid("ocb iv must be 128 bits");var d,r=s.mode.ocb2.A,l=s.bitArray,c=l.k,h=[0,0,0,0];a=r(t.encrypt(a));var m,u=[];for(n=n||[],i=i||64,d=0;d+4<e.length;d+=4)h=c(h,m=e.slice(d,d+4)),u=u.concat(c(a,t.encrypt(c(a,m)))),a=r(a);return m=e.slice(d),e=l.bitLength(m),d=t.encrypt(c(a,[0,0,0,e])),m=l.clamp(c(m,d),e),h=c(h,c(m,d)),h=t.encrypt(c(h,c(a,r(a)))),n.length&&(h=c(h,o?n:s.mode.ocb2.pmac(t,n))),u.concat(l.concat(m,l.clamp(h,i)))},decrypt:function(t,e,a,n,i,o){if(128!==s.bitArray.bitLength(a))throw new s.exception.invalid("ocb iv must be 128 bits");i=i||64;var d,r,l=s.mode.ocb2.A,c=s.bitArray,h=c.k,m=[0,0,0,0],u=l(t.encrypt(a)),p=s.bitArray.bitLength(e)-i,f=[];for(n=n||[],a=0;a+4<p/32;a+=4)d=h(u,t.decrypt(h(u,e.slice(a,a+4)))),m=h(m,d),f=f.concat(d),u=l(u);if(r=p-32*a,d=t.encrypt(h(u,[0,0,0,r])),d=h(d,c.clamp(e.slice(a),r)),m=h(m,d),m=t.encrypt(h(m,h(u,l(u)))),n.length&&(m=h(m,o?n:s.mode.ocb2.pmac(t,n))),!c.equal(c.clamp(m,i),c.bitSlice(e,p)))throw new s.exception.corrupt("ocb: tag doesn't match");return f.concat(c.clamp(d,r))},pmac:function(t,e){var a,n=s.mode.ocb2.A,i=s.bitArray,o=i.k,d=[0,0,0,0],r=t.encrypt([0,0,0,0]);for(r=o(r,n(n(r))),a=0;a+4<e.length;a+=4)r=n(r),d=o(d,t.encrypt(o(r,e.slice(a,a+4))));return e=e.slice(a),i.bitLength(e)<128&&(r=o(r,n(r)),e=i.concat(e,[-2147483648])),d=o(d,e),t.encrypt(o(n(o(r,n(r))),d))},A:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},s.misc.hmac=function(t,e){this.M=e=e||s.hash.sha256;var a=[[],[]],n=e.prototype.blockSize/32;for(this.l=[new e,new e],t.length>n&&(t=e.hash(t)),e=0;e<n;e++)a[0][e]=909522486^t[e],a[1][e]=1549556828^t[e];this.l[0].update(a[0]),this.l[1].update(a[1])},s.misc.hmac.prototype.encrypt=s.misc.hmac.prototype.mac=function(t,e){return t=new this.M(this.l[0]).update(t,e).finalize(),new this.M(this.l[1]).update(t).finalize()},s.misc.pbkdf2=function(t,e,a,n,i){if(a=a||1e3,n<0||a<0)throw s.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=s.codec.utf8String.toBits(t)),t=new(i=i||s.misc.hmac)(t);var o,d,r,l,c=[],h=s.bitArray;for(l=1;32*c.length<(n||1);l++){for(i=o=t.encrypt(h.concat(e,[l])),d=1;d<a;d++)for(o=t.encrypt(o),r=0;r<o.length;r++)i[r]^=o[r];c=c.concat(i)}return n&&(c=h.clamp(c,n)),c},s.random={randomWords:function(t,e){var a,n=[];if(0===(e=this.isReady(e)))throw new s.exception.notready("generator isn't seeded");for(2&e&&this.U(!(1&e)),e=0;e<t;e+=4)(e+1)%65536==0&&this.L(),a=this.u(),n.push(a[0],a[1],a[2],a[3]);return this.L(),n.slice(0,t)},setDefaultParanoia:function(t){this.t=t},addEntropy:function(t,e,a){a=a||"user";var n,i,o=(new Date).valueOf(),d=this.q[a],r=this.isReady();switch(void 0===(n=this.F[a])&&(n=this.F[a]=this.R++),void 0===d&&(d=this.q[a]=0),this.q[a]=(this.q[a]+1)%this.b.length,typeof t){case"number":break;case"object":if(void 0===e)for(a=e=0;a<t.length;a++)for(i=t[a];i>0;)e++,i>>>=1;this.b[d].update([n,this.J++,2,e,o,t.length].concat(t));break;case"string":void 0===e&&(e=t.length),this.b[d].update([n,this.J++,3,e,o,t.length]),this.b[d].update(t);break;default:throw new s.exception.bug("random: addEntropy only supports number, array or string")}this.j[d]+=e,this.f+=e,0===r&&(0!==this.isReady()&&this.K("seeded",Math.max(this.g,this.f)),this.K("progress",this.getProgress()))},isReady:function(t){return t=this.B[void 0!==t?t:this.t],this.g&&this.g>=t?this.j[0]>80&&(new Date).valueOf()>this.O?3:1:this.f>=t?2:0},getProgress:function(t){return t=this.B[t||this.t],this.g>=t?1["0"]:this.f>t?1["0"]:this.f/t},startCollectors:function(){if(!this.m){if(window.addEventListener)window.addEventListener("load",this.o,!1),window.addEventListener("mousemove",this.p,!1);else{if(!document.attachEvent)throw new s.exception.bug("can't attach event");document.attachEvent("onload",this.o),document.attachEvent("onmousemove",this.p)}this.m=!0}},stopCollectors:function(){this.m&&(window.removeEventListener?(window.removeEventListener("load",this.o),window.removeEventListener("mousemove",this.p)):window.detachEvent&&(window.detachEvent("onload",this.o),window.detachEvent("onmousemove",this.p)),this.m=!1)},addEventListener:function(t,e){this.r[t][this.Q++]=e},removeEventListener:function(t,e){var a;t=this.r[t];var s=[];for(a in t)t.hasOwnProperty[a]&&t[a]===e&&s.push(a);for(e=0;e<s.length;e++)delete t[a=s[e]]},b:[new s.hash.sha256],j:[0],z:0,q:{},J:0,F:{},R:0,g:0,f:0,O:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],s:void 0,t:6,m:!1,r:{progress:{},seeded:{}},Q:0,B:[0,48,64,96,128,192,256,384,512,768,1024],u:function(){for(var t=0;t<4&&(this.d[t]=this.d[t]+1|0,!this.d[t]);t++);return this.s.encrypt(this.d)},L:function(){this.a=this.u().concat(this.u()),this.s=new s.cipher.aes(this.a)},T:function(t){for(this.a=s.hash.sha256.hash(this.a.concat(t)),this.s=new s.cipher.aes(this.a),t=0;t<4&&(this.d[t]=this.d[t]+1|0,!this.d[t]);t++);},U:function(t){var e,a=[],n=0;for(this.O=a[0]=(new Date).valueOf()+3e4,e=0;e<16;e++)a.push(4294967296*Math.random()|0);for(e=0;e<this.b.length&&(a=a.concat(this.b[e].finalize()),n+=this.j[e],this.j[e]=0,t||!(this.z&1<<e));e++);this.z>=1<<this.b.length&&(this.b.push(new s.hash.sha256),this.j.push(0)),this.f-=n,n>this.g&&(this.g=n),this.z++,this.T(a)},p:function(t){s.random.addEntropy([t.x||t.clientX||t.offsetX,t.y||t.clientY||t.offsetY],2,"mouse")},o:function(){s.random.addEntropy(new Date,2,"loadtime")},K:function(t,e){var a;t=s.random.r[t];var n=[];for(a in t)t.hasOwnProperty(a)&&n.push(t[a]);for(a=0;a<n.length;a++)n[a](e)}},s.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,e,a,n){a=a||{},n=n||{};var i=s.json,o=i.c({iv:s.random.randomWords(4,0)},i.defaults);if(i.c(o,a),"string"==typeof o.salt&&(o.salt=s.codec.base64.toBits(o.salt)),"string"==typeof o.iv&&(o.iv=s.codec.base64.toBits(o.iv)),!s.mode[o.mode]||!s.cipher[o.cipher]||"string"==typeof t&&o.iter<=100||64!==o.ts&&96!==o.ts&&128!==o.ts||128!==o.ks&&192!==o.ks&&256!==o.ks||o.iv.length<2||o.iv.length>4)throw new s.exception.invalid("json encrypt: invalid parameters");return"string"==typeof t&&(t=(a=s.misc.cachedPbkdf2(t,o)).key.slice(0,o.ks/32),o.salt=a.salt),"string"==typeof e&&(e=s.codec.utf8String.toBits(e)),a=new s.cipher[o.cipher](t),i.c(n,o),n.key=t,o.ct=s.mode[o.mode].encrypt(a,e,o.iv,o.adata,o.tag),i.encode(i.V(o,i.defaults))},decrypt:function(t,e,a,n){a=a||{},n=n||{};var i=s.json;if("string"==typeof(e=i.c(i.c(i.c({},i.defaults),i.decode(e)),a,!0)).salt&&(e.salt=s.codec.base64.toBits(e.salt)),"string"==typeof e.iv&&(e.iv=s.codec.base64.toBits(e.iv)),!s.mode[e.mode]||!s.cipher[e.cipher]||"string"==typeof t&&e.iter<=100||64!==e.ts&&96!==e.ts&&128!==e.ts||128!==e.ks&&192!==e.ks&&256!==e.ks||!e.iv||e.iv.length<2||e.iv.length>4)throw new s.exception.invalid("json decrypt: invalid parameters");return"string"==typeof t&&(t=(a=s.misc.cachedPbkdf2(t,e)).key.slice(0,e.ks/32),e.salt=a.salt),a=new s.cipher[e.cipher](t),a=s.mode[e.mode].decrypt(a,e.ct,e.iv,e.adata,e.tag),i.c(n,e),n.key=t,s.codec.utf8String.fromBits(a)},encode:function(t){var e,a="{",n="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new s.exception.invalid("json encode: invalid property name");switch(a+=n+e+":",n=",",typeof t[e]){case"number":case"boolean":a+=t[e];break;case"string":a+='"'+escape(t[e])+'"';break;case"object":a+='"'+s.codec.base64.fromBits(t[e],1)+'"';break;default:throw new s.exception.bug("json encode: unsupported type")}}return a+"}"},decode:function(t){if(!(t=t.replace(/\s/g,"")).match(/^\{.*\}$/))throw new s.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var e,a,n={};for(e=0;e<t.length;e++){if(!(a=t[e].match(/^([a-z][a-z0-9]*):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new s.exception.invalid("json decode: this isn't json!");n[a[1]]=a[2]?parseInt(a[2],10):a[1].match(/^(ct|salt|iv)$/)?s.codec.base64.toBits(a[3]):unescape(a[3])}return n},c:function(t,e,a){if(void 0===t&&(t={}),void 0===e)return t;var n;for(n in e)if(e.hasOwnProperty(n)){if(a&&void 0!==t[n]&&t[n]!==e[n])throw new s.exception.invalid("required parameter overridden");t[n]=e[n]}return t},V:function(t,e){var a,s={};for(a in t)t.hasOwnProperty(a)&&t[a]!==e[a]&&(s[a]=t[a]);return s},W:function(t,e){var a,s={};for(a=0;a<e.length;a++)void 0!==t[e[a]]&&(s[e[a]]=t[e[a]]);return s}},s.encrypt=s.json.encrypt,s.decrypt=s.json.decrypt,s.misc.S={},s.misc.cachedPbkdf2=function(t,e){var a,n=s.misc.S;return a=(e=e||{}).iter||1e3,(a=(n=n[t]=n[t]||{})[a]=n[a]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):s.random.randomWords(2,0)})[n=void 0===e.salt?a.firstSalt:e.salt]=a[n]||s.misc.pbkdf2(t,n,e.iter),{key:a[n].slice(0),salt:n.slice(0)}},t.exports=s},function(t,e,a){"use strict";var s=a(0),n=new function(){var t=this;this.open=!1,this.dataNmlist={},this.dataIdlist={},this.Add=function(t,e,a){a=a||s.decode(e,!0),this.data[t]=[e,[],1],this.dataNmlist[a]=t,this.dataIdlist[t]=a},this.SortByUses=function(){var t=[];for(var e in this.data)t.push({id:parseInt(e,10),uses:this.data[e][this.defn.uses]});t.sort(function(t,e){return e.uses-t.uses});for(var a=0;a<t.length;a++)t[a]=t[a].id;return t},this.IDs2Names=function(t,e){var a,n=[];if(t&&t instanceof Array)for(var i=0;i<t.length;i++)isNaN(t[i])?!1!==(a=s.decode(t[i],!0))&&n.push((e||"")+a):this.dataIdlist[t[i]]&&n.push((e||"")+this.dataIdlist[t[i]]);return n.sort()},this.IDs2Str=function(t){return(t=this.IDs2Names(t)).length>0?t.join(" "):""},this.Names2IDs=function(t,e){var a=[];if(t&&t instanceof Array)for(var n=[],i=null,o=0;o<t.length;o++){var d=t[o].slice(0,100);n.has(d)||(this.dataNmlist[d]?a.push(this.dataNmlist[d]):e||!1===(i=s.encode(d,!0))||a.push(i),n.push(d))}return a},this.Str2IDs=function(t,e){return this.Names2IDs(this.Str2Names(t),e)},this.Str2Names=function(t){var e=[];return t&&t.match&&(t=t.match(/(\S+)/g))&&t instanceof Array&&t.forEach(function(t){e.has(t)||e.push(t)}),e},this.StrParse=function(e){var a=[],s=[],n=[],i=[],o=[],d=[],r=[];return this.Str2Names(e).sort().forEach(function(e){var l=e.charAt(0),c="-"===l,h=":"===l;if((c||h)&&(e=e.slice(1)),e)if(h)r.push(e);else{var m=t.dataNmlist[e];m?c?(s.push(m),i.push(e)):(a.push(m),n.push(e)):c?d.push(e):o.push(e)}}),{tinc:a,texc:s,ninc:n,nexc:i,winc:o,wexc:d,wcmd:r}},this.StrBuild=function(t){var e=[];return t.wcmd&&t.wcmd instanceof Array&&t.wcmd.sort().forEach(function(t){e.push(":"+t)}),t.ninc&&t.ninc instanceof Array&&t.ninc.sort().forEach(function(t){e.push(t)}),t.nexc&&t.nexc instanceof Array&&t.nexc.sort().forEach(function(t){e.push("-"+t)}),t.winc&&t.winc instanceof Array&&t.winc.sort().forEach(function(t){e.push(t)}),t.wexc&&t.wexc instanceof Array&&t.wexc.sort().forEach(function(t){e.push("-"+t)}),e.join(" ")},this.Linked=function(e){var a,s=[],n={};if(e&&e instanceof Array)if(1===e.length)s=this.data[e[0]][this.defn.links];else for(a in e.forEach(function(e){t.data[e][t.defn.links].forEach(function(t){n[t]=(n[t]?n[t]:0)+1})}),n)n[a]===e.length&&s.push(parseInt(a,10));return s},this.Init=function(t){for(var e in this.data=t.data,this.defn=t.defn,this.data){var a=s.decode(this.data[e][this.defn.name]);this.dataNmlist[a]=e=parseInt(e,10),this.dataIdlist[e]=a}}};t.exports=n},function(t,e,a){"use strict";var s=a(0),n=a(1),i=a(5),o=a(3),d=new function(){var t=this,e=function(t,e){var a=[],n=[],i=null;return t.entries.forEach(function(t){var e=s.decode(t.name),o=s.decode(t.data);if(n.push(e.toLowerCase()),n.push(o.toLowerCase()),4!==t.id_type&&o){var d=e.length>30?e.slice(0,25)+"...":e,r=o.length>50?o.slice(0,35)+"...":o;2===t.id_type&&((o.search("http://")>=0||o.search("https://")>=0||o.search("ftp://")>=0)&&o.search(".")>=0?(r=element("a",{target:"_blank",href:o},r),i||(i=o)):r=element("b",{},r)),a.push(element("span",{className:"name"},d+":")),a.push(element("span",{className:"data"},r))}}),i&&(i=i.split("/"))[2]&&"localhost"!==i[2]&&element("img",{className:"icon",src:"http://www.getfavicon.org/get.pl?url="+i[2]},null,{onload:function(){var t=e.parentNode;t.removeChild(e),elchild(t,this)}}),t.fulltext=n.join("\n"),a.length>0?a:element("div",{className:"warn"},"there is no data")},a=function(t){return t.ctrlKey?NoteFilter.TagSubtract(this.tagnm):this.finc?NoteFilter.TagInclude(this.tagnm):NoteFilter.TagExclude(this.tagnm),!1},d=function(t){var e=[],s=[],n=[];return t.tags.length>0&&(t.tags.forEach(function(t){NoteFilter.data.tinc.has(t)?n.push(o.dataIdlist[t]):s.push(o.dataIdlist[t])}),n.sort().forEach(function(t){(t=element("span",{className:"tag include",tagnm:t,title:"click on this tag to exclude it from the search"},t)).addEventListener("click",a),e.push(t)}),s.sort().forEach(function(t){(t=element("span",{className:"tag",finc:!0,tagnm:t,title:"click on this tag to include it to the search"},t)).addEventListener("click",a),e.push(t)})),e.length>0?e:"there are no tags"},r=function(t){var e="img/tags/note.svg";return o.IDs2Names(t.tags).forEach(function(t){i.some(function(e){return e.name===t})&&(e="img/tags/"+t+".svg")}),e};this.UpdateCtrlBlock=function(e){if(!e){var a=this.GetNotesVisible();elchild(elclear(t.dom.tpinfo),[element("span",{className:"amount"},[element("p",{},"notes "),element("b",{title:"the limited amount of visible notes received according the search options (usually the first 20)"},a.length)," of ",element("span",{title:"the general amount of notes satisfying the giving search options"},this.data.total),a.length<this.data.notes.length?[element("p",{className:"div"},"|"),element("b",{title:"the amount of notes excluded from the note list due to the search filter"},this.data.notes.length-a.length)," filtered"]:null,this.data.notes.length<this.data.total?[element("p",{className:"div"},"|"),element("a",{},"load all",{onclick:function(){NoteFilter.NotesRequest(!0)}})]:null]),element("span",{},[element("p",{},"select "),element("a",{},"all",{onclick:function(){t.SetNotesState(a,"marked",!0),t.UpdateCtrlBlock(!0)}}),element("p",{className:"div"},"|"),element("a",{},"none",{onclick:function(){t.SetNotesState(a,"marked",!1),t.UpdateCtrlBlock(!0)}}),element("p",{className:"div"},"|"),element("a",{},"invert",{onclick:function(){t.SetNotesState(a,"marked"),t.UpdateCtrlBlock(!0)}})])])}var s=this.GetNotesByState("marked");this.dom.btndelete.style.display="none",this.dom.btnrestore.style.display="none",s.length>0&&((NoteFilter.data.wcmd.has("deleted")?this.dom.btnrestore:this.dom.btndelete).style.display="block"),this.dom.tpbar.style.display=0===this.data.total?"none":"block"},this.ClearNotesState=function(e){var a,s=e||t.dom.notes.childNodes;for(a=0;a<s.length;a++)s[a].className="note",s[a].state.active=s[a].state.marked=!1},this.SetNotesState=function(t,e,a){t.length>0&&t.forEach(function(t){t.state[e]=void 0!==a?a:!t.state[e],t.classList.toggle(e,t.state[e])})},this.GetNotesByState=function(e){var a,s=[],n=t.dom.notes.childNodes;for(a=0;a<n.length;a++)!0===n[a].state[e]&&s.push(n[a]);return s},this.GetNoteByID=function(t){for(var e=0,a=this.dom.notes.childNodes;e<a.length;e++)if(a[e].data.id===t)return a[e];return!1},this.GetNotesVisible=function(){for(var t=0,e=[],a=this.dom.notes.childNodes;t<a.length;t++)a[t].style.display||e.push(a[t]);return e};var l=function(e){if(e.ctrlKey)t.SetNotesState([this],"marked");else{var a=t.GetNotesByState("active"),s=a.length>0&&a[0].data.id===this.data.id,n=NoteEditor.HasChanges();if(!n||s||n&&NoteEditor.ConfirmExit())if(t.ClearNotesState(),NoteEditor.GetNoteID()!==this.data.id&&NoteEditor.Load(this.data),t.SetNotesState([this],"active"),e.shiftKey){var i,o,d=!1;for(i=0;i<t.dom.notes.childNodes.length;i++)(o=t.dom.notes.childNodes[i]).data.id!==a[0].data.id&&o.data.id!==this.data.id||(d=!d),(d||o.data.id===a[0].data.id||o.data.id===this.data.id)&&t.SetNotesState([o],"marked")}else t.SetNotesState([this],"marked")}t.UpdateCtrlBlock()},c=function(){return t.SetNotesState([this.note],"marked"),t.UpdateCtrlBlock(),!1};this.BuildNote=function(t){var a=element("div",{className:"note",data:t,dom:{},state:{}});return elchild(a,[element("div",{className:"icon"},[a.dom.icon=element("img",{className:"icon",src:r(t)}),a.dom.tick=element("div",{className:"tick",note:a})]),element("div",{className:"body"},[a.dom.info=element("div",{className:"info"},e(t,a.dom.icon)),a.dom.tags=element("div",{className:"tags"},d(t))])]),a.addEventListener("click",l),a.dom.tick.addEventListener("click",c),a},this.SetNotesVisibility=function(t){t=t||this.dom.notes.childNodes;var e,a,s=[];for(e=0;e<t.length;e++)(a=!0)&&(NoteFilter.data.winc.forEach(function(s){t[e].data.fulltext.indexOf(s.toLowerCase())<0&&(a=!1)}),a&&NoteFilter.data.wexc.forEach(function(s){t[e].data.fulltext.indexOf(s.toLowerCase())>=0&&(a=!1)})),t[e].style.display=a?"":"none",a||s.push(t[e]);this.ClearNotesState(s),this.UpdateCtrlBlock()},this.BuildTable=function(e,a){if(e=e instanceof Array?e:[],this.data.notes=e,this.data.total=a,elclear(this.dom.notes),a>0){var s,n=NoteEditor.GetNoteID();e.forEach(function(e){s=t.BuildNote(e),t.SetNotesVisibility([s]),elchild(t.dom.notes,s),n===e.id&&t.SetNotesState([s],"active")})}this.UpdateCtrlBlock()};var h=function(){if(confirm(this.undo?"You are going to restore all checked notes in the note list. Do you really want to continue?":"You are going to delete all checked notes in the note list. Do you really want to continue?")){var e=[];t.GetNotesByState("marked").forEach(function(t){t.data.id&&e.push(t.data.id)}),function(t,e){t.length>0&&n.post("note/delete"+(e?"/undo":""),{ids:t},function(a,s){if(NoteFilter.MsgClear(),s.error)NoteFilter.MsgAdd("The request was not successful. The response from the server: "+s.error,"error");else{var n=[(e?"The selected notes were successfully restored ":"The selected notes were successfully removed ")+"(amount:"+s.count+"). "];e||n.push(" It is still possible to ",element("a",{className:"bold"},"restore them",{onclick:function(){NoteFilter.RequestDeleted()}})),t.has(NoteEditor.GetNoteID())&&NoteEditor.Escape(),NoteFilter.MsgAdd(n),NoteFilter.NotesRequest()}})}(e,this.undo)}};this.Init=function(t){t.handle&&(this.dom={handle:t.handle},this.data={total:0,notes:[]},elchild(this.dom.handle,[this.dom.tpbar=element("div",{className:"tpbar"},[this.dom.tpctrl=element("div",{className:"ctrl"},[this.dom.btndelete=element("input",{type:"button",value:"Delete",undo:!1,className:"button hidden"},null,{onclick:h}),this.dom.btnrestore=element("input",{type:"button",value:"Restore",undo:!0,className:"button hidden"},null,{onclick:h})]),this.dom.tpinfo=element("div",{className:"info"})]),this.dom.notes=element("div",{className:"notes"})]))}};t.exports=d},function(t,e,a){"use strict";t.exports=[{name:"note",description:"simple note with title and text",entries:[{id:1,name:"title"},{id:6,name:"description"}]},{name:"site",description:"regular site bookmark",entries:[{id:2,name:"site url"},{id:5,name:"email"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"email",description:"email address record",entries:[{id:2,name:"site url"},{id:5,name:"email"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"messenger",description:"instant messenger account information",entries:[{id:2,name:"site url"},{id:5,name:"email"},{id:3,name:"username"},{id:4,name:"password"},{id:1,name:"phone"},{id:6,name:"comments"}]},{name:"ftp",description:"ftp server data",entries:[{id:2,name:"server address"},{id:3,name:"username"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"ssh",description:"ssh server data",entries:[{id:2,name:"server address"},{id:3,name:"username"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"database",description:"database access parameters",entries:[{id:2,name:"server address"},{id:1,name:"database name"},{id:3,name:"username"},{id:4,name:"password"},{id:6,name:"comments"}]}]},function(t,e,a){"use strict";var s=a(5),n=new function(){var t=this,e="In the list above please select a template to be used to create your new note.";this.Fill=function(){elclear(t.dom.list),s.forEach(function(e){var a=element("div",{className:"item",data:e},element("div",{className:"line "+e.name},[element("div",{className:"name"},e.name),element("div",{className:"hint"},e.description)]));elchild(t.dom.list,a),a.addEventListener("click",function(){t.Show(!1),NoteEditor.Create(this.data)}),a.addEventListener("mouseenter",function(){var a=[];e.entries.forEach(function(t){a.push("<b>"+t.name+"</b>")}),t.dom.hint.innerHTML="This template will create a note with this set of entries:<br>"+a.join(", ")})})},this.Show=function(t){this.dom.handle.style.display=t?"block":"none"},this.Init=function(a){a.handle&&(this.dom={handle:a.handle},elchild(this.dom.handle,[this.dom.title=element("div",{className:"title"}),this.dom.list=element("div",{className:"list"}),this.dom.hint=element("div",{className:"hint"},e)]),this.dom.handle.addEventListener("mouseleave",function(){t.dom.hint.innerHTML=e}),elchild(this.dom.title,[element("div",{className:"text"},"Templates")]),this.Fill())}};t.exports=n},function(t,e,a){"use strict";var s,n=a(0),i=a(2),o=a(1),d=a(4),r=a(6),l=a(3);a(8),a(9),a(11),a(12),window.Logout=function(){o.post("user/logout",null,function(t,e){t||location.reload()})},window.initData=function(t,e,a){n.setPass(e),window.dataUser=t,window.done?a():o.get("user/tags",function(t,e){t||(l.Init(e),d.Init({handle:document.querySelector("div.notelist")}),NoteFilter.Init({handle:document.querySelector("div.notefilter")}),r.Init({handle:document.querySelector("div.templatelist")}),NoteEditor.Init({handle:document.querySelector("div.noteeditor")}),window.pageMain.style.display="block",window.done=!0,a())})},window.exportData=null,window.exportDataJson=null,window.pageMain=document.getElementById("pageMain"),i.random.startCollectors(),s=setInterval(function(){i.random.isReady()&&(i.random.stopCollectors(),clearInterval(s))},1e3),o.get("user/info",function(t,e){e?(window.dataUser=e,n.setPassHash(e.hash),DlgPassGet.Show({escClose:!1})):DlgUserLogin.Show({escClose:!1})})},function(t,e,a){"use strict";var s=a(1),n=a(4),i=a(3),o=new function(){var t=this,e="click on this word to remove it from the filtering";this.MsgClear=function(){elclear(this.dom.messages)},this.MsgAdd=function(t,e){elchild(this.dom.messages,element("div",{className:e||"info"},t))},this.SetFocus=function(){this.dom.input.focus()};this.RequestLatest=function(){this.Reset(),this.NotesRequest()},this.RequestDeleted=function(){this.MsgClear(),this.dom.input.value=":deleted",this.UpdateParsedInput(),this.NotesRequest()},this.NotesRequest=function(e){for(var a in t.dom.icon.className="icon loading",t.dom.messages.className="messages loading",this.data)this.post[a]=this.data[a].slice();s.post("note/search",{tinc:this.post.tinc,texc:this.post.texc,wcmd:this.post.wcmd,all:e},function(e,a){a.error?t.MsgAdd("The request was not successful. The response from the server: "+a.error,"fail"):(n.BuildTable(a.notes,a.total),0===a.total&&(t.data.tinc.length||t.data.texc.length||t.data.wcmd.length)&&t.MsgAdd(["There are no records to meet the given search options. You can change these options or see your ",element("a",{className:"bold"},"latest notes",{onclick:function(){t.RequestLatest()}})])),t.dom.icon.className="icon",t.dom.messages.className="messages"})},this.UpdateParsedInput=function(){this.dom.input.value.trim()!==this.dom.input.data.oldval.trim()&&(this.data=i.StrParse(this.dom.input.value),this.dom.input.data.oldval=this.dom.input.value)},this.DoSearch=function(t){var e=this.dom.input.data;this.UpdateParsedInput(),0!==e.history.length&&e.history[e.history.length-1]===this.dom.input.value||(e.history.push(this.dom.input.value),e.histpos=e.history.length),t&&(this.dom.input.data.oldval=this.dom.input.value=i.StrBuild(this.data)),a()};var a=function(){if(t.MsgClear(),t.data.tinc.sort().join()!=t.post.tinc.sort().join()||t.data.texc.sort().join()!=t.post.texc.sort().join()||t.data.wcmd.sort().join()!=t.post.wcmd.sort().join()||""==t.dom.input.value.trim()?t.NotesRequest():n.SetNotesVisibility(),t.data.winc.length>0||t.data.wexc.length>0){var a=[];t.data.winc.sort().forEach(function(t){a.push(element("a",{title:e,word:t,fexc:!1},t,{onclick:o}))}),t.data.wexc.sort().forEach(function(t){a.push(element("a",{title:e,word:t,fexc:!0},"-"+t,{onclick:o}))}),t.MsgAdd(["Here is the list of words used which are not your tags:",a,". It was used for text filtering."])}};this.TagInclude=function(t){var e=i.dataNmlist[t];e&&!this.data.tinc.has(e)&&(this.data.tinc.push(e),this.data.ninc.push(t),this.dom.input.data.oldval=this.dom.input.value=i.StrBuild(this.data)),a()},this.TagExclude=function(t){var e=i.dataNmlist[t];if(e&&this.data.tinc.has(e)){var s=this.data.tinc.indexOf(e),n=this.data.ninc.indexOf(t);s>=0&&this.data.tinc.splice(s,1),n>=0&&this.data.ninc.splice(n,1),this.dom.input.data.oldval=this.dom.input.value=i.StrBuild(this.data)}a()},this.TagSubtract=function(t){var e=i.dataNmlist[t];if(e&&!this.data.texc.has(e)){var s=this.data.tinc.indexOf(e),n=this.data.ninc.indexOf(t);s>=0&&this.data.tinc.splice(s,1),n>=0&&this.data.ninc.splice(n,1),this.data.texc.push(e),this.data.nexc.push(t),this.dom.input.data.oldval=this.dom.input.value=i.StrBuild(this.data)}a()};var o=function(){var e=this.fexc?t.data.wexc:t.data.winc,a=e.indexOf(this.word);a>=0&&(e.splice(a,1),this.parentNode.removeChild(this),0===t.data.winc.length&&0===t.data.wexc.length&&t.MsgClear(),t.dom.input.data.oldval=t.dom.input.value=i.StrBuild(t.data),n.SetNotesVisibility())};this.Reset=function(){this.dom.input.data.oldval=this.dom.input.value="",t.dom.input.focus(),this.data=i.StrParse(),this.post=i.StrParse(),t.MsgClear()},this.Init=function(e){e.handle&&(this.dom={handle:e.handle},this.data=i.StrParse(),this.post=i.StrParse(),elchild(this.dom.handle,[element("div",{className:"search"},[this.dom.home=element("div",{className:"home"},element("div",{title:"reset all search parameters and filters and request the latest active notes"},null,{onclick:function(){t.RequestLatest()}})),this.dom.input=element("input",{className:"line",placeholder:"search by tags or content ...",type:"text",data:{encval:"",oldval:"",history:[],histpos:0}}),this.dom.icon=element("div",{className:"icon"})]),this.dom.messages=element("div",{className:"messages"})]),$(this.dom.input).autocomplete({matchInside:!1,selectFirst:!0,useDelimiter:!0,delimiterChar:" ",delimiterKeyCode:32,minChars:1,autoWidth:"width",delay:200,data:[!0],showResult:function(t){return t},processData:function(e){if(e.length>0&&(t.UpdateParsedInput(),e=[],t.data.wcmd.has("deleted")||e.push([":deleted",0]),t.data.wcmd.has("notags")||e.push([":notags",0]),t.data.wcmd.has("day")||t.data.wcmd.has("week")||t.data.wcmd.has("month")||e.push([":day",0],[":week",0],[":month",0]),!t.data.wcmd.has("notags"))){var a=[];for(var s in t.data.tinc.length>0&&(a=i.Linked(t.data.tinc)),i.dataNmlist){var n=i.dataNmlist[s];(0===t.data.tinc.length||a.has(n))&&(t.data.tinc.has(n)||t.data.texc.has(n)||e.push([s,n],["-"+s,n]))}}return e}}),this.ac=$(this.dom.input).data("autocompleter"),this.dom.input.addEventListener("keydown",function(e){if(13===e.keyCode&&t.DoSearch(e.ctrlKey),38===e.keyCode&&!t.ac.active_&&this.data.histpos>0){for(;this.data.history[--this.data.histpos]&&this.data.history[this.data.histpos].trim()===this.value.trim(););this.data.histpos>=0&&(this.value=this.data.history[this.data.histpos])}if(40===e.keyCode&&!t.ac.active_&&this.data.histpos<this.data.history.length-1){for(;this.data.history[++this.data.histpos]&&this.data.history[this.data.histpos].trim()===this.value.trim(););this.data.histpos<this.data.history.length&&(this.value=this.data.history[this.data.histpos])}e.ctrlKey&&32===e.keyCode&&t.ac.activate()}),a(),n.UpdateCtrlBlock(!0))}};window.NoteFilter=o,t.exports=o},function(t,e,a){"use strict";var s=a(0),n=a(1),i=a(4),o=a(6),d=a(3),r=a(5),l=a(10);window.NoteEditor=new function(){var t=this,e=!1,a="Will save all your changes. You can also press Ctrl+Enter",c=function(t,e){if(e=e||[],(t=d.Str2Names(t)).length!==e.length)return!0;for(var a=null,s=0;s<t.length;s++){if(!(a=d.dataNmlist[t[s]]))return!0;if(!e.has(a))return!0}return!1};this.Save=function(){this.HasChanges()&&(u(!1),n.post("note/save/"+(this.data.id||""),function(){var e=0,a=null,n=[],i=[];for(t.data.tags=d.Str2IDs(t.dom.tags.input.value.toLowerCase()),t.data.tags.join()!==t.post.tags.join()?t.post.tags=0===t.data.tags.length?0:t.data.tags.slice():delete t.post.tags,t.post.entries=[],e=0;e<t.dom.entries.childNodes.length;e++)t.dom.entries.childNodes[e].deleted&&n.push(t.dom.entries.childNodes[e]);for(e=0;e<n.length;e++)n[e].data.id&&i.push(n[e].data.id),t.dom.entries.removeChild(n[e]);for(i.length>0&&(t.post.deleted=i),e=0;e<t.dom.entries.childNodes.length;e++){var o={};(a=t.dom.entries.childNodes[e]).data.id&&(o.id=a.data.id),a.post.id_type===a.data.id_type&&void 0!==a.data.id||(o.id_type=a.data.id_type),a.post.name_dec===a.dom.name.value&&void 0!==a.data.id||(a.data.name=o.name=a.data.name_dec===a.dom.name.value?a.data.name:s.encode(a.dom.name.value),a.data.name_dec=a.dom.name.value),a.post.data_dec===a.dom.data.value&&void 0!==a.data.id||(a.data.data=o.data=a.data.data_dec===a.dom.data.value?a.data.data:s.encode(a.dom.data.value),a.data.data_dec=a.dom.data.value),a.dom.type.style.display="none",a.dom.history.style.display="none",elclear(a.dom.history),delete a.data.history,t.post.entries.push(o)}return t.post}(),function(a,s){if(s&&s.id&&s.entries){t.data.id;t.data.id=s.id;for(var n=[],i=0;i<t.dom.entries.childNodes.length;i++){var o=t.dom.entries.childNodes[i];o.data.id=s.entries[i].id,o.post.name=o.data.name,o.post.name_dec=o.data.name_dec,o.post.data=o.data.data,o.post.data_dec=o.data.data_dec,o.post.id_type=o.data.id_type,o.dom.name.classList.remove("changed"),o.dom.data.classList.remove("changed"),t.dom.tags.input.classList.remove("changed"),s.entries[i].changed&&(o.dom.icon.src="img/field_flag_ok.png"),s.entries[i].added&&(o.dom.icon.src="img/field_flag_add.png"),n.push(o.data)}if(t.data.entries=n,s.tags){if(s.tags instanceof Array&&t.data.tags.length===s.tags.length)for(i=0;i<s.tags.length;i++)isNaN(t.data.tags[i])&&(d.Add(s.tags[i],t.data.tags[i]),t.data.tags[i]=s.tags[i]);t.dom.tags.icon.src="img/field_flag_ok.png"}t.dom.tags.input.value=d.IDs2Str(t.data.tags).toLowerCase(),t.post.tags=t.data.tags.slice(),delete t.post.deleted,setTimeout(function(){for(var e=0;e<t.dom.entries.childNodes.length;e++){var a=t.dom.entries.childNodes[e];a.dom.icon.src="img/field_"+l.hash[a.data.id_type].name+".png"}t.dom.tags.icon.src="img/field_tag.png"},2e3),e=!1,NoteFilter.NotesRequest()}u(!0),p()}))};this.ProceedUrlIcon=function(t){t&&t.query&&t.query.results};var h=function(a){a.dom.btn_config=element("img",{src:"img/settings.svg",className:"button",title:"change entry type"},null,{onclick:function(){!function(a){if(0===a.dom.type.childNodes.length){var n=table(1,0,{className:"list"},{onmouseout:function(){a.dom.desc.innerHTML=a.dom.desc.value}}),i=null;for(var o in l.hash)o=parseInt(o,10),(i=element("td",{className:a.data.id_type===o?"current":"item"},l.hash[o].name,{onmouseover:function(){a.dom.desc.innerHTML=this.desc},onclick:function(){if("item"==this.className){a.dom.name.value=l.hash[this.type].name,a.data.id_type=this.type,a.data.name=s.encode(a.dom.name.value),a.data.name_dec=a.dom.name.value,a.data.data=s.encode(a.dom.data.value),a.data.data_dec=a.dom.data.value;var n=m(a.data);n.post=a.post,n.dom.name.onchange(),n.dom.data.onchange(),t.dom.entries.insertBefore(n,a),t.dom.entries.removeChild(a),e=!0}}})).type=o,i.name=l.hash[o].name,i.desc=l.hash[o].description,elchild(n,i);elchild(a.dom.type,n)}a.dom.type.style.display="block"!==a.dom.type.style.display?"block":"none"}(a)}}),a.dom.btn_history=element("img",{src:"img/history.svg",className:"button",title:"show/hide entry hisory values"},null,{onclick:function(){!function(e){e.data.history||(t.data.id&&e.data.id?(elchild(elclear(e.dom.history),element("div",{className:"info"},"loading ...")),n.get("note/history/"+t.data.id+"/"+e.data.id,function(t,a){if(!t){elclear(e.dom.history),e.data.history=a;var n=element("table",{className:"maxw"});if(a.data.length){for(var i=0;i<a.data.length;i++){var o=a.data[i][a.defn.name]?s.decode(a.data[i][a.defn.name]):"",d=a.data[i][a.defn.data]?s.decode(a.data[i][a.defn.data]):"";tblrow(n,[element("span",{title:o},o.length>20?o.slice(0,15)+"...":o),element("span",{title:d},d.length>30?d.slice(0,25)+"...":d),element("a",{name:o,data:d},"use",{onclick:function(){e.dom.name.value=this.name,e.dom.data.value=this.data,e.dom.name.onchange(),e.dom.data.onchange(),e.dom.history.style.display="none"}})],[{className:"name"},{className:"data"},{className:"ctrl"}])}elchild(elclear(e.dom.history),n)}else elchild(elclear(e.dom.history),element("div",{className:"info"},"there are no history records for this entry"))}})):(e.data.history=[],elchild(elclear(e.dom.history),element("div",{className:"info"},"there are no history records for this entry")))),e.dom.history.style.display="block"!==e.dom.history.style.display?"block":"none"}(a)}}),a.dom.btn_add=element("img",{src:"img/add.svg",className:"button",title:"add new entry after this one"},null,{onclick:function(){!function(a){var n=l.hash[a.data.id_type].name,i=4==a.data.id_type?pwdgen(20):"",o=m({id_type:a.data.id_type,name:s.encode(n),name_dec:n,data:s.encode(i),data_dec:i});t.dom.entries.insertBefore(o,a),o.dom.name.classList.add("changed"),o.dom.data.classList.add("changed"),e=!0}(a)}}),a.dom.btn_up=element("img",{src:"img/arrow_up.svg",className:"button",title:"move this entry one row up"},null,{onclick:function(){!function(a){a.previousSibling&&(t.dom.entries.insertBefore(a,a.previousSibling),e=!0)}(a)}}),a.dom.btn_down=element("img",{src:"img/arrow_down.svg",className:"button",title:"move this entry one row down"},null,{onclick:function(){!function(a){a.nextSibling&&(t.dom.entries.insertBefore(a,a.nextSibling.nextSibling),e=!0)}(a)}}),a.dom.btn_delete=element("img",{src:"img/clear.svg",className:"button",title:"delete this entry"},null,{onclick:function(){!function(a){t.dom.entries.childNodes.length>1&&(a.dom.undo.classList.toggle("hidden"),a.dom.body.classList.toggle("hidden"),a.deleted=!0,e=!0)}(a)}});var i=[];return 4===a.data.id_type&&(a.dom.btn_pwdgen=element("img",{src:"img/refresh.svg",className:"button",title:"generate a new password"},null,{onclick:function(){a.dom.data.value=pwdgen(20),a.dom.data.onchange()}}),a.dom.btn_maskpwd=element("img",{src:"img/visibility_off.svg",className:"button",title:"Show password"},null,{onclick:function(){"text"===a.dom.data.type?(this.title="Show password",this.src="img/visibility_off.svg",a.dom.data.type="password"):(this.src="img/visibility.svg",this.title="Hide password",a.dom.data.type="text")}}),a.dom.data.type="password",i.push(a.dom.btn_maskpwd),i.push(a.dom.btn_pwdgen)),i.push(a.dom.btn_config,a.dom.btn_history,a.dom.btn_add,a.dom.btn_up,a.dom.btn_down,a.dom.btn_delete),a.dom.controls=element("div",{className:"hidden"},i)},m=function(e){var a=element("div",{className:"entry"});return a.dom={undo:element("div",{className:"undo hidden"}),body:element("div",{className:"body"})},a.data=e||{},a.post={id_type:e.id_type,name:e.name,name_dec:e.name_dec,data:e.data,data_dec:e.data_dec},function(e){e.dom.type=element("div",{className:"type"});var a=l.hash[e.data.id_type].max;6===e.data.id_type||7===e.data.id_type?(e.dom.data=element("textarea",{className:"text",maxLength:a},e.data.data_dec),e.dom.data.addEventListener("keydown",function(t){38===t.keyCode&&e.previousSibling&&0===this.selectionStart&&e.previousSibling.dom.data.focus(),40===t.keyCode&&e.nextSibling&&this.selectionStart===this.value.length&&e.nextSibling.dom.data.focus()})):(e.dom.data=element("input",{type:5===e.data.id_type?"email":"text",maxLength:a,className:5===e.data.id_type?"email":"line",value:e.data.data_dec}),e.dom.data.addEventListener("keydown",function(t){38===t.keyCode&&e.previousSibling&&e.previousSibling.dom.data.focus(),40===t.keyCode&&e.nextSibling&&e.nextSibling.dom.data.focus()})),e.dom.data.autocomplete="off",e.dom.data.onchange=function(){this.value=this.value.trim(),t.data.id&&(null!=e.post.data_dec&&e.post.data_dec!=this.value?this.classList.add("changed"):this.classList.remove("changed"))},e.dom.history=element("div",{className:"history"}),e.dom.data.onkeyup=function(){e.dom.counter.innerHTML=this.value.length,this.value.length>=this.maxLength&&"limit"!=e.dom.counter.className?e.dom.counter.className="limit":this.value.length<this.maxLength&&"limit"==e.dom.counter.className&&(e.dom.counter.className="")},e.dom.data.onkeydown=e.dom.data.onkeyup}(a),function(t){t.dom.desc=element("span",{},l.hash[t.data.id_type].description),t.dom.desc.value=l.hash[t.data.id_type].description,t.dom.counter=element("span",{className:t.dom.data.value.length===t.dom.data.maxLength?"limit":""},t.dom.data.value.length),t.dom.hint=tblrow(element("table",{className:"hint"}),[t.dom.desc,t.dom.counter],[{className:"text"},{className:"counter"}])}(a),h(a),function(e){e.dom.name=element("input",{type:"text",maxLength:256,value:e.data.name_dec},"",{onchange:function(){this.value=this.value.trim(),t.data.id&&(null!==e.post.name_dec&&e.post.name_dec!==this.value?this.classList.add("changed"):this.classList.remove("changed"))}}),e.dom.name.addEventListener("keydown",function(t){38===t.keyCode&&e.previousSibling&&e.previousSibling.dom.name.focus(),40===t.keyCode&&e.nextSibling&&e.nextSibling.dom.name.focus()}),e.dom.icon=element("img",{src:"img/field_"+l.hash[e.data.id_type].name+".png"}),e.dom.title=tblrow(element("table",{className:"title"}),[e.dom.icon,e.dom.name,e.dom.controls],[{className:"icon"},{className:"name"},{className:"controls"}])}(a),elchild(a.dom.body,[a.dom.title,a.dom.type,a.dom.data,a.dom.history,a.dom.hint]),elchild(a,[a.dom.undo,a.dom.body]),elchild(a.dom.undo,element("a",{},"restore deleted entry",{onclick:function(){a.dom.undo.classList.toggle("hidden"),a.dom.body.classList.toggle("hidden"),a.deleted=!1}})),a.addEventListener("mouseenter",function(){a.previousSibling?a.dom.btn_up.className="button":a.dom.btn_up.className="disabled",a.nextSibling?a.dom.btn_down.className="button":a.dom.btn_down.className="disabled",1===t.dom.entries.childNodes.length?a.dom.btn_delete.className="disabled":a.dom.btn_delete.className="button",a.dom.controls.classList.remove("hidden")}),a.addEventListener("mouseleave",function(){a.dom.controls.classList.add("hidden")}),a},u=function(e){if(t.dom.bcontrols)for(var a=t.dom.bcontrols.childNodes,s=0;s<a.length;s++)a[s].disabled=!e};this.ConfirmExit=function(){return confirm("The current note has unsaved changes. Do you really want to continue and lost these changes?")},this.Clone=function(){delete this.data.id,this.data.entries.forEach(function(t){delete t.id}),this.post.tags=[],e=!0,this.Save(),this.dom.entries.childNodes[0].dom.data.focus()},this.New=function(){var t,a,n=[];this.data.entries.forEach(function(e){t=l.hash[e.id_type].name,a=4==e.id_type?pwdgen(20):"",n.push({id_type:e.id_type,name:s.encode(t),name_dec:t,data:s.encode(a),data_dec:a})}),this.Escape(!0)&&(this.data.entries=n,f(),p(),e=!0,this.dom.entries.childNodes[0].dom.data.focus())},this.Escape=function(a){var s=NoteEditor.HasChanges();if(!s||s&&this.ConfirmExit()){var n=i.GetNoteByID(t.data.id);return!1!==n&&i.SetNotesState([n],"active",!1),elclear(this.dom.handle),this.data={tags:[],entries:[]},this.post={tags:[]},e=!1,a||(t.Show(!1),o.Show(!0)),!0}return!1},this.Create=function(t){this.data={tags:[],entries:[]},this.post={tags:[]};var e,a,n,i=this;t?(t.entries.forEach(function(t){a=4===t.id?pwdgen(20):"",i.data.entries.push({id_type:t.id,name:s.encode(t.name),name_dec:t.name,data:s.encode(a),data_dec:a})}),n=t.name,this.data.tags=d.Str2IDs(n)):(e=l.hash[1].name,a=n="",this.data.entries=[{id_type:1,name:s.encode(e),name_dec:e,data:s.encode(a),data_dec:a}]),f(),this.dom.tags.input.value=n.toLowerCase(),p(),this.dom.entries.childNodes[0].dom.data.focus()},this.Load=function(e){if(this.data=e,t.post={tags:e.tags?e.tags.slice():[]},e.id&&e.entries&&e.entries instanceof Array)for(var a=0;a<e.entries.length;a++){var n=e.entries[a];n.name_dec=s.decode(n.name),n.data_dec=s.decode(n.data)}else this.Create();f(),this.dom.tags.input.value=d.IDs2Str(this.data.tags).toLowerCase(),p()},this.GetNoteID=function(){return this.data&&this.data.id?this.data.id:null};var p=function(e){var a;e||(e="img/tags/note.svg",(a=t.dom.tags.input.value.toLowerCase().match(/(\S+)/g))&&a.forEach(function(t){r.some(function(e){return e.name===t})&&(e="img/tags/"+t+".svg")})),t.dom.title.icon.src.search(e)<0&&(t.dom.title.icon.src=e)},f=function(){e=!1,t.dom.title=element("div",{className:"caption"}),t.dom.title.icon=element("img",{width:32,height:32}),elchild(t.dom.title,tblrow(element("table",{className:"maxw"}),[t.dom.title.icon,[element("div",{className:"main"},"Note")],[t.data.ctime?element("div",{},"created: "+TimestampToDateStr(t.data.ctime)):"",t.data.mtime?element("div",{},"edited: "+TimestampToDateStr(t.data.mtime)):""]],[{className:"icon"},{className:"name"},{className:"info"}])),function(){t.dom.entries=element("div",{className:"entries"});for(var e=0;e<t.data.entries.length;e++)elchild(t.dom.entries,m(t.data.entries[e]));t.dom.entries}(),function(){var e=element("input",{type:"text",maxLength:1024,className:"line",value:""}),a=element("img",{src:"img/field_tag.png"});t.dom.tags=element("div",{className:"tags"},[tblrow(element("table",{className:"title"}),[a,"tags"],[{className:"icon"},{className:"name"}]),e,element("div",{className:"hint"},"list of associated tags separated by space")]),t.dom.tags.input=e,t.dom.tags.icon=a,e.onchange=function(){t.data.id&&(c(this.value,t.post.tags)?this.classList.add("changed"):this.classList.remove("changed"))};var s=[];for(var n in d.dataIdlist)s.push([d.dataIdlist[n],n]);$(t.dom.tags.input).autocomplete({matchInside:!1,selectFirst:!0,useDelimiter:!0,delimiterChar:" ",delimiterKeyCode:32,minChars:1,autoWidth:"width",delay:200,data:s,showResult:function(t){return t},processData:function(e){var a=[],s=t.dom.tags.input.value.toLowerCase().match(/(\S+)/g);return e.forEach(function(t){s.has(t[0])||a.push(t)}),a}}),t.dom.tags}(),t.dom.tcontrols=element("div",{className:"tbuttons"},[element("input",{type:"button",value:"Back",className:"button left",title:"Will discard all your current changes and show the template list."},null,{onclick:function(){t.Escape()}}),element("input",{type:"button",value:"New",className:"button left",title:"Will create a new note based on the current one."},null,{onclick:function(){t.New()}}),element("input",{type:"button",value:"Duplicate",className:"button left",title:"Will save the current note as a copy."},null,{onclick:function(){t.Clone()}}),element("input",{type:"button",value:"Save",className:"button bold",title:a},null,{onclick:function(){t.Save()}})]),t.dom.bcontrols=element("div",{className:"bbuttons"},[element("input",{type:"button",value:"Save",className:"button bold",title:a},null,{onclick:function(){t.Save()}})]),elclear(t.dom.handle),elchild(t.dom.handle,[t.dom.title,t.dom.tcontrols,t.dom.entries,element("div",{className:"divider"}),t.dom.tags,element("div",{className:"divider"}),t.dom.bcontrols]),o.Show(!1),t.Show(!0)};this.Show=function(t){this.dom.handle.style.display=t?"block":"none"},this.HasChanges=function(){var t,a,s=e;if(this.data&&this.data.entries&&this.data.entries.length>0&&!e){for(t=0;t<this.dom.entries.childNodes.length;t++)if(null!=(a=this.dom.entries.childNodes[t]).post.data_dec&&a.post.data_dec!=a.dom.data.value||null!=a.post.name_dec&&a.post.name_dec!=a.dom.name.value||a.post.id_type!=a.data.id_type){s=!0;break}!s&&c(this.dom.tags.input.value.toLowerCase(),this.post.tags)&&(s=!0)}return s},this.Init=function(e){e.handle&&(this.dom={handle:e.handle},this.onsave=e.onsave||null,this.oncancel=e.oncancel||null,t.dom.handle.addEventListener("keypress",function(e){13===e.keyCode&&e.ctrlKey&&t.Save()}),t.dom.handle.addEventListener("keydown",function(e){27===e.keyCode&&t.Escape()}))}}},function(t,e,a){"use strict";var s=[{id:1,max:1024,name:"line",icon:"https://image.flaticon.com/icons/svg/23/23187.svg",description:"title or short one line text description"},{id:2,max:2048,name:"uri",icon:"https://image.flaticon.com/icons/svg/117/117965.svg",description:"any addresses - http/https/ftp/ssh or file path"},{id:3,max:1024,name:"login",icon:"https://image.flaticon.com/icons/svg/149/149452.svg",description:"user name, login or email in some cases"},{id:4,max:4096,name:"password",icon:"https://image.flaticon.com/icons/svg/263/263069.svg",description:"any secret letters sequence"},{id:5,max:1024,name:"email",icon:"https://image.flaticon.com/icons/svg/60/60381.svg",description:"email address line"},{id:6,max:65535,name:"text",icon:"https://image.flaticon.com/icons/svg/140/140952.svg",description:"plain text entry for notes"},{id:7,max:65535,name:"html",icon:"https://image.flaticon.com/icons/svg/25/25252.svg",description:"formatted text entry for notes"}],n={};s.forEach(function(t){n[t.id]=t}),t.exports={list:s,hash:n}},function(t,e,a){var s=a(2);Array.prototype.has=function(t){return this.indexOf(t)>=0},window.onEnterClick=function(t,e){t.addEventListener("keydown",function(t){13===t.keyCode&&e.click()})},window.elchild=function t(e,a){if(e&&a)if(a.nodeType)e.appendChild(a);else if(a instanceof Array)for(var s=0;s<a.length;s++)t(e,a[s]);else e.appendChild(document.createTextNode(a));return e},window.elclear=function(t){if(t&&t.hasChildNodes())for(;t.hasChildNodes();)t.removeChild(t.firstChild);return t},window.elattr=function(t,e){if(t&&t.nodeType&&e&&e instanceof Object)for(var a in e)t[a]=e[a];return t},window.element=function(t,e,a,s){var n=document.createElement(t);if(elattr(n,e),elchild(n,a),s&&s instanceof Object)for(var i in s)n[i]=s[i];return n},window.table=function(t,e,a,s){for(var n=element("table",a,null,s),i=0;i<t;i++){n.insertRow(-1);for(var o=0;o<e;o++)n.rows[i].insertCell(-1)}return n},window.tblrow=function(t,e,a){for(var s=t.insertRow(-1),n=0;n<e.length;n++)s.insertCell(-1),elchild(s.cells[n],e[n]),elattr(s.cells[n],a[n]);return t},window.TimestampToDateStr=function(t){var e=t?new Date(1e3*t):new Date,a=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),i=e.getHours(),o=e.getMinutes();return s<10&&(s="0"+s),n<10&&(n="0"+n),i<10&&(i="0"+i),o<10&&(o="0"+o),a+"."+s+"."+n+" "+i+":"+o},window.pwdgen=function(t){for(var e,a="abcdefghijklnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&{}()[]=+?*<>;,.:-_",n=[],i="";i.length<t;)e=null,s.random.isReady()?(e=String.fromCharCode(parseInt(s.codec.hex.fromBits(s.random.randomWords(1)).substr(0,2),16)),-1===a.indexOf(e)&&(e=null)):e=a.charAt(Math.floor(Math.random()*a.length)),e&&n.indexOf(e.toLowerCase())<0&&(n.push(e.toLowerCase()),i+=e);return i}},function(t,e,a){"use strict";var s,n=a(0),i=a(2),o=a(1),d=a(13),r=a(14),l=null,c=null,h=null,m=null;l=new d({width:750,title:"Data export",hint:"Here you can get all your data unencrypted.",dom:{},onCreate:function(){this.SetContent(this.dom.text=element("textarea",{className:"export"}))},EventOpen:function(){window.exportData?setTimeout(function(){for(var t in l.Show(),window.exportData.notes){if(window.exportData.notes[t]instanceof Array&&window.exportData.notes[t].forEach(function(t){var e=n.decode(t.name,!0),a=n.decode(t.data,!0);e&&a&&(l.dom.text.value+=e+": "+a+"\n")}),window.exportData.note_tags[t]instanceof Array){var e=[];window.exportData.note_tags[t].forEach(function(t){window.exportData.tags[t]&&e.push(n.decode(window.exportData.tags[t],!0))}),e.length>0&&(l.dom.text.value+="tags: "+e.join(" ")+"\n")}l.dom.text.value+="\n"}l.dom.text.value=l.dom.text.value.trim(),window.exportData=null},50):window.exportDataJson&&(l.dom.text.value=window.exportDataJson,window.exportDataJson=null,setTimeout(function(){l.Show()},50))},EventClose:function(){l.Close()},controls:{Close:{main:!0,onClick:function(){this.modal.Close()}}}}),c=new d({width:650,title:"Options",hint:"Here you can create/restore backups and export all your data.",onCreate:function(){var t=element("input",{type:"file",name:"file",id:"file-upload",onchange:function(){a.innerHTML=this.value,e.value="File selected"}}),e=element("input",{type:"button",className:"button long",value:"Choose file ...",onclick:function(){t.click()}}),a=element("div",{className:"fhint"});this.SetContent([element("div",{className:"desc"},"Backup is an archived package of all your encrypted data. It can't be read by human but can be used to restore your account info or setup a copy on some other FortNotes instance."),element("input",{type:"button",className:"button long",value:"Create backup",onclick:function(){window.location=o.defaults.server+"user/export/txt"}}),element("div",{className:"desc"},'Please specify your previously downloaded backup package and then press the "Restore backup" button. It will upload your backup to the server and replace all your current data with the data from this backup. Warning: this operation can\'t be reverted!'),element("div",{},[element("input",{type:"button",className:"button long",value:"Restore backup",onclick:function(){var e=this;e.value="Uploading ...",e.disabled=!0;var a=new FormData;a.append("file",t.files[0]),o.postForm("user/import/txt",a,function(t,a){t||(e.value="Restore backup",e.disabled=!1,a&&a.error?alert("Restore from backup failed. Error: "+a.error):(alert("The restore process has completed successfully and now the page will be reloaded to apply the restored data."),window.location.reload()))})}})," ",e,a]),element("div",{className:"desc"},"It's possible to export all the data in a human readable form in order to print it or save in file on some storage. It'll give all the data in plain unencrypted form. The password is required."),element("input",{type:"button",className:"button long",value:"Export as TEXT",onclick:function(){var t=this;t.value="Loading ...",t.disabled=!0,o.get("user/export/plain",function(e,a){e||(window.exportData=a,t.value="Export as TEXT",t.disabled=!1,n.expirePass())})}})," ",element("input",{type:"button",className:"button long",value:"Export as JSON",onclick:function(){var t=this;t.value="Loading ...",t.disabled=!0,o.get("user/export/txt",function(e,a){e||(window.exportDataJson=JSON.stringify(function(t){let e={notes:[],tags:[]},a={1:"line",2:"uri",3:"login",4:"password",5:"email",6:"text",7:"html"};return Object.values(t.note_entries).forEach(e=>{e.name=n.decode(e.name),e.data=n.decode(e.data);let s=t.notes[e.id_note],i={type:a[e.id_type],name:e.name,data:e.data};"text"!==i.type&&"html"!==i.type||(i.hidden=!0),s.blocks=s.blocks||[],s.blocks.push(i)}),Object.values(t.tags).forEach(t=>{t.name=n.decode(t.name),e.tags.push({name:t.name,ctime:1e3*t.ctime})}),Object.values(t.note_tags).forEach(e=>{let a=t.notes[e.id_note],s=t.tags[e.id_tag];a.tags=a.tags||[],a.tags.push(s.name)}),Object.values(t.notes).forEach(t=>{t.is_active&&e.notes.push({ctime:1e3*t.ctime,mtime:1e3*t.mtime,blocks:t.blocks,tags:t.tags})}),e}(a),null,"    "),t.value="Export as JSON",t.disabled=!1,n.expirePass())})}})])},EventClose:function(){c.Close()},controls:{Close:{main:!0,onClick:function(){this.modal.Close()}}}}),h=new d({width:500,title:"Password",hint:"Please enter your password to unlock encrypted data.",data:{attempts:0},onCreate:function(){this.data.fldlist=new r({cols:[{className:"colname"},{className:"colvalue"}],attr:{}}),this.data.pass=element("input",{type:"password",autocomplete:"current-password",className:"line"}),this.data.linkset=element("a",{className:"combo",title:"click to change the password storing time"}),onEnterClick(this.data.pass,this.params.controls["Continue"].dom),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"password"),element("br"),element("span",{className:"fldhint"},"your secret key")],[element("input",{type:"text",autocomplete:"username",className:"hidden",value:n.get("username_last_used","")}),this.data.pass]],{}),this.SetContent(element("form",{},this.data.fldlist.dom.table))},onShow:function(){},EventClose:function(){h.Show({escClose:!1})},controls:{"Log off":{main:!1,onClick:function(){this.modal.Close(),Logout()}},Continue:{main:!0,onClick:function(){var t=this.modal,e=t.data.pass.value;n.checkPass(e)?initData(window.dataUser,e,function(){t.data.attempts=0,t.data.pass.value="",t.Close()}):(t.data.pass.focus(),t.data.attempts++,1===t.data.attempts?t.SetMessage("Password is invalid!"):t.SetMessage(["Password is invalid!",element("br"),"Logged attempts: "+t.data.attempts]))}}}}),s=new d({width:500,title:"Authentication",hint:"Welcome back! Please authorize.",data:{attempts:0},onCreate:function(){this.data.fldlist=new r({cols:[{className:"colname"},{className:"colvalue"}],attr:{}}),this.data.name=element("input",{className:"line",autocomplete:"username",type:"text",value:n.get("username_last_used","")}),this.data.pass=element("input",{className:"line",autocomplete:"current-password",type:"password"}),this.data.serv=element("input",{className:"line",autocomplete:"server",type:"url",value:n.get("server","https://fortnotes.com/")}),onEnterClick(this.data.pass,this.params.controls["Login"].dom),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"username"),element("br"),element("span",{className:"fldhint"},"your name or email")],this.data.name],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"password"),element("br"),element("span",{className:"fldhint"},"your secret key")],this.data.pass],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"server"),element("br"),element("span",{className:"fldhint"},"data storage")],this.data.serv],{}),this.SetContent(element("form",{},this.data.fldlist.dom.table))},controls:{Register:{onClick:function(){this.modal.Close(),m.Show({escClose:!1})}},Login:{main:!0,onClick:function(){var t=this.modal,e=t.data.name.value,a=t.data.pass.value;e&&a?(e=i.codec.hex.fromBits(i.hash.sha256.hash(e)),a=i.codec.hex.fromBits(i.hash.sha256.hash(a)),t.EnableControls(!1),t.data.name.disabled=!0,t.data.pass.disabled=!0,t.data.attempts>1&&t.SetLoading("Sending server request ..."),n.set("server",t.data.serv.value,!0),o.defaults.server=t.data.serv.value,o.post("user/auth",{name:e,pass:a,mode:"login"},function(e,a){if(e)t.SetMessage("Request error.","error");else{if(a){if(a&&a.id)return void initData(a,t.data.pass.value,function(){n.set("username_last_used",t.data.name.value,!0),t.data.name.value="",t.data.pass.value="",t.Close()});t.data.attempts++,1===t.data.attempts?t.SetMessage("Invalid user name or password.","error"):t.SetMessage(["Invalid user name or password.",element("br"),"Logged attempts: "+t.data.attempts],"error")}else t.SetMessage("Invalid response from the server.");t.EnableControls(!0),t.data.name.disabled=!1,t.data.pass.disabled=!1}})):t.SetMessage("Empty user name or password.")}}}}),m=new d({width:550,title:"Registration",hint:"You are going to register in the system. Please note that the password you are going to enter will be used not only to login but also to encrypt/decrypt your data so choose a strong and long password. Your registration data won't be sent to the server in plain unencrypted form. Only hashes are stored on the server. We don't know your password and will never ask you to send it to us but at the same time we won't be able to remind it to you so please keep that password utmost safe.",data:{attempts:0},onShow:function(){var t=this;o.get("captcha/uri",function(e,a){e||(a&&a.src?t.data.cimg.src=o.defaults.server+a.src:(t.SetHint("New accounts registration is disabled."),t.SetContent("")))})},onCreate:function(){this.data.fldlist=new r({cols:[{className:"colname"},{className:"colvalue"}],attr:{}}),this.data.name=element("input",{type:"text",autocomplete:"username",className:"line"}),this.data.pass1=element("input",{type:"password",autocomplete:"new-password",className:"line"}),this.data.pass2=element("input",{type:"password",autocomplete:"new-password",className:"line"}),this.data.cimg=element("img",{width:161,height:75}),this.data.code=element("input",{type:"text",autocomplete:"off",className:"line cline",title:"case insensitive code above"}),onEnterClick(this.data.code,this.params.controls["Register"].dom),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"username"),element("br"),element("span",{className:"fldhint"},"your name or email")],this.data.name],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"password"),element("br"),element("span",{className:"fldhint"},"your secret key")],this.data.pass1],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"confirm password"),element("br"),element("span",{className:"fldhint"},"your secret key once more")],this.data.pass2],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"captcha"),element("br"),element("span",{className:"fldwhint"},"enter the code on the image to make sure this is not an automated registration")],[this.data.cimg,element("br"),this.data.code]],{}),this.dom.footer.classList.add("hidden");var t=this;this.SetContent(element("a",{},"I understand that my password can't be restored and will keep it safe",{onclick:function(){var e=document.getElementById("simplemodal-container");t.SetHint("Keep your password safe - you are the only one who knows it so there is no way to restore it!"),e.style.top=parseInt(e.style.top,10)-100+"px",t.SetContent(element("form",{},t.data.fldlist.dom.table)),t.dom.footer.classList.remove("hidden"),t.data.name.focus()}}))},controls:{Cancel:{onClick:function(){this.modal.Close()}},Register:{main:!0,onClick:function(){var t,e=this.modal,a=e.data.name.value,s=e.data.pass1.value,d=e.data.pass2.value;a&&s&&d&&s===d?(a=i.codec.hex.fromBits(i.hash.sha256.hash(a)),t=i.codec.hex.fromBits(i.hash.sha256.hash(s)),e.EnableControls(!1),e.data.name.disabled=!0,e.data.pass1.disabled=!0,e.data.pass2.disabled=!0,e.data.attempts>1&&e.SetLoading("Sending server request ..."),o.post("user/auth",{name:a,pass:t,code:e.data.code.value,mode:"register"},function(t,a){if(t)e.SetMessage("Request error.","error");else{if(a)if(!1!==a.code){if(a&&a.id)return void initData(a,s,function(){n.set("username_last_used",e.data.name.value,!0),e.data.name.value="",e.data.pass1.value="",e.data.pass2.value="",e.Close(),window.pageMain.style.display="block"});e.data.attempts++,1===e.data.attempts?e.SetMessage(["Invalid user name or password.",element("br"),"There maybe already a user with the same name or there are some technical problems on the server."],"error"):e.SetMessage(["Invalid user name or password.",element("br"),"Logged attempts: "+e.data.attempts],"error")}else e.SetMessage("Invalid captcha code. Please correct it and try once again.");else e.SetMessage("Invalid responce from the server.");e.EnableControls(!0),e.data.name.disabled=!1,e.data.pass1.disabled=!1,e.data.pass2.disabled=!1}})):e.SetMessage("Empty one of the required field or passwords don't match.")}}}}),n.subscribe(l),n.subscribe(c),n.subscribe(h),window.DlgExport=l,window.DlgOptions=c,window.DlgPassGet=h,window.DlgUserLogin=s,window.DlgUserRegister=m,t.exports={DlgExport:l,DlgOptions:c,DlgPassGet:h,DlgUserLogin:s,DlgUserRegister:m}},function(t,e,a){"use strict";t.exports=function(t){this.params=t,this.data=t.data||{},this.dom={},this.SetWidth=function(t){this.dom.body.style.width=t+"px"},this.Show=function(t){t=t||{},this.params.onShow&&this.params.onShow instanceof Function&&this.params.onShow.call(this),$(this.dom.main).modal(t)},this.Close=function(t){if(t){var e=this;setTimeout(function(){$.modal.close(),e.Reset()},parseInt(t,10))}else $.modal.close(),this.Reset()},this.Reset=function(){this.SetMessage()},this.SetTitle=function(t){},this.SetHint=function(t){t?(0===this.dom.hint.childNodes.length&&this.dom.hint.appendChild(element("div",{className:"info"},t)),this.dom.hint.childNodes[0].innerHTML=t,this.dom.hint.style.display=""):this.dom.hint.style.display="none"},this.SetMessage=function(t,e){t?(e=e||"warning",elchild(elclear(this.dom.message),element("div",{className:"message "+e},t)),this.dom.message.style.display=""):this.dom.message.style.display="none"},this.SetLoading=function(t){this.SetMessage(t,"loading")},this.SetContent=function(t){t?(elclear(this.dom.content),elchild(this.dom.content,t)):this.dom.content.style.display="none"},this.EnableControls=function(t){if(this.params.controls)for(var e in this.params.controls)this.params.controls[e].dom.disabled=!t},this.Init=function(){if(this.dom.body=element("div",{className:"body"},[this.dom.title=element("div",{className:"block title"},this.params.title),this.dom.hint=element("div",{className:"block hint"}),this.dom.content=element("div",{className:"block content"}),this.dom.message=element("div",{className:"block info"}),this.dom.footer=element("div",{className:"block footer"})]),this.dom.main=element("div",{className:"dialogmodal"},this.dom.body),this.params.width&&this.SetWidth(this.params.width),this.SetHint(this.params.hint),this.SetMessage(this.params.message),this.params.controls)for(var t in this.params.controls){var e=this.params.controls[t];e.dom=element("input",{type:"button",value:t,className:"button"}),e.dom.modal=this,e.main&&(e.dom.className+=" bold"),e.onClick&&e.onClick instanceof Function&&(e.dom.onclick=e.onClick),this.dom.footer.appendChild(e.dom)}this.params.onCreate&&this.params.onCreate instanceof Function&&this.params.onCreate.call(this),this.params.EventClose&&this.params.EventClose instanceof Function&&(this.EventClose=this.params.EventClose),this.params.EventOpen&&this.params.EventOpen instanceof Function&&(this.EventOpen=this.params.EventOpen),this.params.content&&(this.params.content.style.display="",this.dom.content.appendChild(this.params.content))},this.Init()}},function(t,e,a){"use strict";t.exports=function(t){this.params=t,this.dom={},this.SetCols=function(t){this.params.cols=t},this.AddRow=function(t,e){if(t&&t instanceof Array&&t.length===this.params.cols.length){var a=null,s=this.dom.table.insertRow(-1);elattr(s,e);for(var n=0;n<this.params.cols.length;n++)(a=s.insertCell(-1)).className=this.params.cols[n],elchild(a,t[n]),elattr(a,this.params.cols[n]);return s}return!1},this.AddDivider=function(t,e){var a=this.dom.table.insertRow(-1).insertCell(-1);elattr(a,{colspan:this.params.cols.length}),elchild(a,element("div",{className:"divider"}))},this.Init=function(){this.dom.table=element("table",{className:"fldlist"}),elattr(this.dom.table,this.params.attr)},this.Init()}}]);
//# sourceMappingURL=main.js.map