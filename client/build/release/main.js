!function(a){var s={};function n(t){if(s[t])return s[t].exports;var e=s[t]={i:t,l:!1,exports:{}};return a[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}n.m=a,n.c=s,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,a){"use strict";var r=a(2),s=new function(){var a=this;this.data={};var s=null,n=null,i={ks:256,ts:128,mode:"ccm",cipher:"aes"};this.subscribers=[],this.RequestPass=null;var o={},d={};this.set=function(t,e,a){a?localStorage.setItem(t,e):this.data[t]=e},this.get=function(t,e){return this.data[t]||localStorage.getItem(t)||e},this.calcHash=function(t){return r.codec.hex.fromBits(r.hash.sha256.hash(t))},this.hasHash=function(){return null!=n&&""!=n},this.hasPass=function(){return null!==s&&""!==s},this.checkPass=function(t){return!(!this.hasHash()||!t)&&n===this.calcHash(t)},this.setPassHash=function(t){return!!t&&(n=t)},this.setPass=function(t){if(!t)return!1;for(var e in s=t,this.hasHash()||this.setPassHash(this.calcHash(t)),this.subscribers)a.subscribers[e].EventOpen&&a.subscribers[e].EventOpen instanceof Function&&a.subscribers[e].EventOpen();return n},this.expirePass=function(){for(var t in a.subscribers)"function"==typeof a.subscribers[t].EventClose&&a.subscribers[t].EventClose();s=null,o={},d={},a.RequestPass&&a.RequestPass instanceof Function&&a.RequestPass.call()},this.encode=function(t,e){if(s&&!1!==t&&null!==t){if(e&&o[t])return o[t];try{var a=r.encrypt(s,t,i);return e&&(o[t]=a,d[a]=t),a}catch(t){}}return!1},this.decode=function(t,e){if(s&&t){if(e&&d[t])return d[t];try{var a=r.decrypt(s,t);return e&&(d[t]=a,o[a]=t),a}catch(t){}}return!1},this.subscribe=function(t){this.subscribers.push(t)}};t.exports=s},function(t,e,a){"use strict";var n={server:localStorage.getItem("server")||"https://fortnotes.com/",mode:"cors",credentials:"include",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}};function i(t){return 200<=t.status&&t.status<300?Promise.resolve(t):Promise.reject(new Error(t.statusText))}function o(t){return t.json()}t.exports={defaults:n,get:function(t,e){fetch(n.server+t,n).then(i).then(o).then(function(t){e(null,t)}).catch(e)},post:function(t,e,a){fetch(n.server+t,Object.assign({},n,{method:"post",body:JSON.stringify(e)})).then(i).then(o).then(function(t){a(null,t)}).catch(a)},postForm:function(t,e,a){var s=Object.assign({},n,{method:"post",body:e,headers:{Accept:"application/json"}});fetch(n.server+t,s).then(i).then(o).then(function(t){a(null,t)}).catch(a)}}},function(t,e,a){"use strict";var y={cipher:{},hash:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t}}};y.cipher.aes=function(t){this.h[0][0][0]||this.w();var e,a,s,n,i=this.h[0][4],o=this.h[1],d=1;if(4!==(e=t.length)&&6!==e&&8!==e)throw new y.exception.invalid("invalid aes key size");for(this.a=[s=t.slice(0),n=[]],t=e;t<4*e+28;t++)a=s[t-1],(t%e==0||8===e&&t%e==4)&&(a=i[a>>>24]<<24^i[a>>16&255]<<16^i[a>>8&255]<<8^i[255&a],t%e==0&&(a=a<<8^a>>>24^d<<24,d=d<<1^283*(d>>7))),s[t]=s[t-e]^a;for(e=0;t;e++,t--)a=s[3&e?t:t-4],n[e]=t<=4||e<4?a:o[0][i[a>>>24]]^o[1][i[a>>16&255]]^o[2][i[a>>8&255]]^o[3][i[255&a]]},y.cipher.aes.prototype={encrypt:function(t){return this.H(t,0)},decrypt:function(t){return this.H(t,1)},h:[[[],[],[],[],[]],[[],[],[],[],[]]],w:function(){var t,e,a,s,n,i,o,d=this.h[0],r=this.h[1],l=d[4],c=r[4],h=[],m=[];for(t=0;t<256;t++)m[(h[t]=t<<1^283*(t>>7))^t]=t;for(e=a=0;!l[e];e^=s||1,a=m[a]||1)for(i=(i=a^a<<1^a<<2^a<<3^a<<4)>>8^255&i^99,o=16843009*(n=h[t=h[s=h[c[l[e]=i]=e]]])^65537*t^257*s^16843008*e,n=257*h[i]^16843008*i,t=0;t<4;t++)d[t][e]=n=n<<24^n>>>8,r[t][i]=o=o<<24^o>>>8;for(t=0;t<5;t++)d[t]=d[t].slice(0),r[t]=r[t].slice(0)},H:function(t,e){if(4!==t.length)throw new y.exception.invalid("invalid aes block size");var a=this.a[e],s=t[0]^a[0],n=t[e?3:1]^a[1],i=t[2]^a[2];t=t[e?1:3]^a[3];var o,d,r,l,c=a.length/4-2,h=4,m=[0,0,0,0],u=(o=this.h[e])[0],p=o[1],f=o[2],g=o[3],v=o[4];for(l=0;l<c;l++)o=u[s>>>24]^p[n>>16&255]^f[i>>8&255]^g[255&t]^a[h],d=u[n>>>24]^p[i>>16&255]^f[t>>8&255]^g[255&s]^a[h+1],r=u[i>>>24]^p[t>>16&255]^f[s>>8&255]^g[255&n]^a[h+2],t=u[t>>>24]^p[s>>16&255]^f[n>>8&255]^g[255&i]^a[h+3],h+=4,s=o,n=d,i=r;for(l=0;l<4;l++)m[e?3&-l:l]=v[s>>>24]<<24^v[n>>16&255]<<16^v[i>>8&255]<<8^v[255&t]^a[h++],o=s,s=n,n=i,i=t,t=o;return m}},y.bitArray={bitSlice:function(t,e,a){return t=y.bitArray.P(t.slice(e/32),32-(31&e)).slice(1),void 0===a?t:y.bitArray.clamp(t,a-e)},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var a=t[t.length-1],s=y.bitArray.getPartial(a);return 32===s?t.concat(e):y.bitArray.P(e,s,0|a,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return 0===e?0:32*(e-1)+y.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;var a=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,0<a&&e&&(t[a-1]=y.bitArray.partial(e,t[a-1]&2147483648>>e-1,1)),t},partial:function(t,e,a){return 32===t?e:(a?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(y.bitArray.bitLength(t)!==y.bitArray.bitLength(e))return!1;var a,s=0;for(a=0;a<t.length;a++)s|=t[a]^e[a];return 0===s},P:function(t,e,a,s){var n;for(void(n=0)===s&&(s=[]);32<=e;e-=32)s.push(a),a=0;if(0===e)return s.concat(t);for(n=0;n<t.length;n++)s.push(a|t[n]>>>e),a=t[n]<<32-e;return n=t.length?t[t.length-1]:0,t=y.bitArray.getPartial(n),s.push(y.bitArray.partial(e+t&31,32<e+t?a:s.pop(),1)),s},k:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},y.codec.utf8String={fromBits:function(t){var e,a,s="",n=y.bitArray.bitLength(t);for(e=0;e<n/8;e++)0==(3&e)&&(a=t[e/4]),s+=String.fromCharCode(a>>>24),a<<=8;return decodeURIComponent(escape(s))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,a=[],s=0;for(e=0;e<t.length;e++)s=s<<8|t.charCodeAt(e),3==(3&e)&&(a.push(s),s=0);return 3&e&&a.push(y.bitArray.partial(8*(3&e),s)),a}},y.codec.hex={fromBits:function(t){var e,a="";for(e=0;e<t.length;e++)a+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return a.substr(0,y.bitArray.bitLength(t)/4)},toBits:function(t){var e,a,s=[];for(a=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)s.push(0^parseInt(t.substr(e,8),16));return y.bitArray.clamp(s,4*a)}},y.codec.base64={D:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e){var a,s="",n=0,i=y.codec.base64.D,o=0,d=y.bitArray.bitLength(t);for(a=0;6*s.length<d;)s+=i.charAt((o^t[a]>>>n)>>>26),n<6?(o=t[a]<<6-n,n+=26,a++):(o<<=6,n-=6);for(;3&s.length&&!e;)s+="=";return s},toBits:function(t){t=t.replace(/\s|=/g,"");var e,a,s=[],n=0,i=y.codec.base64.D,o=0;for(e=0;e<t.length;e++){if((a=i.indexOf(t.charAt(e)))<0)throw new y.exception.invalid("this isn't base64!");26<n?(n-=26,s.push(o^a>>>n),o=a<<32-n):o^=a<<32-(n+=6)}return 56&n&&s.push(y.bitArray.partial(56&n,o,1)),s}},y.hash.sha256=function(t){this.a[0]||this.w(),t?(this.n=t.n.slice(0),this.i=t.i.slice(0),this.e=t.e):this.reset()},y.hash.sha256.hash=function(t){return(new y.hash.sha256).update(t).finalize()},y.hash.sha256.prototype={blockSize:512,reset:function(){return this.n=this.N.slice(0),this.i=[],this.e=0,this},update:function(t){"string"==typeof t&&(t=y.codec.utf8String.toBits(t));var e,a=this.i=y.bitArray.concat(this.i,t);for(e=this.e,t=this.e=e+y.bitArray.bitLength(t),e=512+e&-512;e<=t;e+=512)this.C(a.splice(0,16));return this},finalize:function(){var t,e=this.i,a=this.n;for(t=(e=y.bitArray.concat(e,[y.bitArray.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this.e/4294967296)),e.push(0|this.e);e.length;)this.C(e.splice(0,16));return this.reset(),a},N:[],a:[],w:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,a=0,s=2;t:for(;a<64;s++){for(e=2;e*e<=s;e++)if(s%e==0)continue t;a<8&&(this.N[a]=t(Math.pow(s,.5))),this.a[a]=t(Math.pow(s,1/3)),a++}},C:function(t){var e,a,s=t.slice(0),n=this.n,i=this.a,o=n[0],d=n[1],r=n[2],l=n[3],c=n[4],h=n[5],m=n[6],u=n[7];for(t=0;t<64;t++)e=(e=t<16?s[t]:(e=s[t+1&15],a=s[t+14&15],s[15&t]=(e>>>7^e>>>18^e>>>3^e<<25^e<<14)+(a>>>17^a>>>19^a>>>10^a<<15^a<<13)+s[15&t]+s[t+9&15]|0))+u+(c>>>6^c>>>11^c>>>25^c<<26^c<<21^c<<7)+(m^c&(h^m))+i[t],u=m,m=h,h=c,c=l+e|0,l=r,r=d,o=e+((d=o)&r^l&(d^r))+(d>>>2^d>>>13^d>>>22^d<<30^d<<19^d<<10)|0;n[0]=n[0]+o|0,n[1]=n[1]+d|0,n[2]=n[2]+r|0,n[3]=n[3]+l|0,n[4]=n[4]+c|0,n[5]=n[5]+h|0,n[6]=n[6]+m|0,n[7]=n[7]+u|0}},y.mode.ccm={name:"ccm",encrypt:function(t,e,a,s,n){var i,o=e.slice(0),d=y.bitArray,r=d.bitLength(a)/8,l=d.bitLength(o)/8;if(n=n||64,s=s||[],r<7)throw new y.exception.invalid("ccm: iv must be at least 7 bytes");for(i=2;i<4&&l>>>8*i;i++);return i<15-r&&(i=15-r),a=d.clamp(a,8*(15-i)),e=y.mode.ccm.G(t,e,a,s,n,i),o=y.mode.ccm.I(t,o,a,e,n,i),d.concat(o.data,o.tag)},decrypt:function(t,e,a,s,n){n=n||64,s=s||[];var i=y.bitArray,o=i.bitLength(a)/8,d=i.bitLength(e),r=i.clamp(e,d-n),l=i.bitSlice(e,d-n);if(d=(d-n)/8,o<7)throw new y.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;e<4&&d>>>8*e;e++);if(e<15-o&&(e=15-o),a=i.clamp(a,8*(15-e)),r=y.mode.ccm.I(t,r,a,l,n,e),t=y.mode.ccm.G(t,r.data,a,s,n,e),!i.equal(r.tag,t))throw new y.exception.corrupt("ccm: tag doesn't match");return r.data},G:function(t,e,a,s,n,i){var o=[],d=y.bitArray,r=d.k;if((n/=8)%2||n<4||16<n)throw new y.exception.invalid("ccm: invalid tag length");if(4294967295<s.length||4294967295<e.length)throw new y.exception.bug("ccm: can't deal with 4GiB or more data");if(i=[d.partial(8,(s.length?64:0)|n-2<<2|i-1)],(i=d.concat(i,a))[3]|=d.bitLength(e)/8,i=t.encrypt(i),s.length)for((a=d.bitLength(s)/8)<=65279?o=[d.partial(16,a)]:a<=4294967295&&(o=d.concat([d.partial(16,65534)],[a])),o=d.concat(o,s),s=0;s<o.length;s+=4)i=t.encrypt(r(i,o.slice(s,s+4)));for(s=0;s<e.length;s+=4)i=t.encrypt(r(i,e.slice(s,s+4)));return d.clamp(i,8*n)},I:function(t,e,a,s,n,i){var o,d=y.bitArray;o=d.k;var r=e.length,l=d.bitLength(e);if(a=d.concat([d.partial(8,i-1)],a).concat([0,0,0]).slice(0,4),s=d.bitSlice(o(s,t.encrypt(a)),0,n),!r)return{tag:s,data:[]};for(o=0;o<r;o+=4)a[3]++,n=t.encrypt(a),e[o]^=n[0],e[o+1]^=n[1],e[o+2]^=n[2],e[o+3]^=n[3];return{tag:s,data:d.clamp(e,l)}}},y.mode.ocb2={name:"ocb2",encrypt:function(t,e,a,s,n,i){if(128!==y.bitArray.bitLength(a))throw new y.exception.invalid("ocb iv must be 128 bits");var o,d=y.mode.ocb2.A,r=y.bitArray,l=r.k,c=[0,0,0,0];a=d(t.encrypt(a));var h,m=[];for(s=s||[],n=n||64,o=0;o+4<e.length;o+=4)c=l(c,h=e.slice(o,o+4)),m=m.concat(l(a,t.encrypt(l(a,h)))),a=d(a);return h=e.slice(o),e=r.bitLength(h),o=t.encrypt(l(a,[0,0,0,e])),c=l(c,l(h=r.clamp(l(h,o),e),o)),c=t.encrypt(l(c,l(a,d(a)))),s.length&&(c=l(c,i?s:y.mode.ocb2.pmac(t,s))),m.concat(r.concat(h,r.clamp(c,n)))},decrypt:function(t,e,a,s,n,i){if(128!==y.bitArray.bitLength(a))throw new y.exception.invalid("ocb iv must be 128 bits");n=n||64;var o,d,r=y.mode.ocb2.A,l=y.bitArray,c=l.k,h=[0,0,0,0],m=r(t.encrypt(a)),u=y.bitArray.bitLength(e)-n,p=[];for(s=s||[],a=0;a+4<u/32;a+=4)h=c(h,o=c(m,t.decrypt(c(m,e.slice(a,a+4))))),p=p.concat(o),m=r(m);if(d=u-32*a,h=c(h,o=c(o=t.encrypt(c(m,[0,0,0,d])),l.clamp(e.slice(a),d))),h=t.encrypt(c(h,c(m,r(m)))),s.length&&(h=c(h,i?s:y.mode.ocb2.pmac(t,s))),!l.equal(l.clamp(h,n),l.bitSlice(e,u)))throw new y.exception.corrupt("ocb: tag doesn't match");return p.concat(l.clamp(o,d))},pmac:function(t,e){var a,s=y.mode.ocb2.A,n=y.bitArray,i=n.k,o=[0,0,0,0],d=t.encrypt([0,0,0,0]);for(d=i(d,s(s(d))),a=0;a+4<e.length;a+=4)d=s(d),o=i(o,t.encrypt(i(d,e.slice(a,a+4))));return e=e.slice(a),n.bitLength(e)<128&&(d=i(d,s(d)),e=n.concat(e,[-2147483648])),o=i(o,e),t.encrypt(i(s(i(d,s(d))),o))},A:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},y.misc.hmac=function(t,e){this.M=e=e||y.hash.sha256;var a=[[],[]],s=e.prototype.blockSize/32;for(this.l=[new e,new e],t.length>s&&(t=e.hash(t)),e=0;e<s;e++)a[0][e]=909522486^t[e],a[1][e]=1549556828^t[e];this.l[0].update(a[0]),this.l[1].update(a[1])},y.misc.hmac.prototype.encrypt=y.misc.hmac.prototype.mac=function(t,e){return t=new this.M(this.l[0]).update(t,e).finalize(),new this.M(this.l[1]).update(t).finalize()},y.misc.pbkdf2=function(t,e,a,s,n){if(a=a||1e3,s<0||a<0)throw y.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=y.codec.utf8String.toBits(t)),t=new(n=n||y.misc.hmac)(t);var i,o,d,r,l=[],c=y.bitArray;for(r=1;32*l.length<(s||1);r++){for(n=i=t.encrypt(c.concat(e,[r])),o=1;o<a;o++)for(i=t.encrypt(i),d=0;d<i.length;d++)n[d]^=i[d];l=l.concat(n)}return s&&(l=c.clamp(l,s)),l},y.random={randomWords:function(t,e){var a,s=[];if(0===(e=this.isReady(e)))throw new y.exception.notready("generator isn't seeded");for(2&e&&this.U(!(1&e)),e=0;e<t;e+=4)(e+1)%65536==0&&this.L(),a=this.u(),s.push(a[0],a[1],a[2],a[3]);return this.L(),s.slice(0,t)},setDefaultParanoia:function(t){this.t=t},addEntropy:function(t,e,a){a=a||"user";var s,n,i=(new Date).valueOf(),o=this.q[a],d=this.isReady();switch(void 0===(s=this.F[a])&&(s=this.F[a]=this.R++),void 0===o&&(o=this.q[a]=0),this.q[a]=(this.q[a]+1)%this.b.length,typeof t){case"number":break;case"object":if(void 0===e)for(a=e=0;a<t.length;a++)for(n=t[a];0<n;)e++,n>>>=1;this.b[o].update([s,this.J++,2,e,i,t.length].concat(t));break;case"string":void 0===e&&(e=t.length),this.b[o].update([s,this.J++,3,e,i,t.length]),this.b[o].update(t);break;default:throw new y.exception.bug("random: addEntropy only supports number, array or string")}this.j[o]+=e,this.f+=e,0===d&&(0!==this.isReady()&&this.K("seeded",Math.max(this.g,this.f)),this.K("progress",this.getProgress()))},isReady:function(t){return t=this.B[void 0!==t?t:this.t],this.g&&this.g>=t?80<this.j[0]&&(new Date).valueOf()>this.O?3:1:this.f>=t?2:0},getProgress:function(t){return t=this.B[t||this.t],this.g>=t?1["0"]:this.f>t?1["0"]:this.f/t},startCollectors:function(){if(!this.m){if(window.addEventListener)window.addEventListener("load",this.o,!1),window.addEventListener("mousemove",this.p,!1);else{if(!document.attachEvent)throw new y.exception.bug("can't attach event");document.attachEvent("onload",this.o),document.attachEvent("onmousemove",this.p)}this.m=!0}},stopCollectors:function(){this.m&&(window.removeEventListener?(window.removeEventListener("load",this.o),window.removeEventListener("mousemove",this.p)):window.detachEvent&&(window.detachEvent("onload",this.o),window.detachEvent("onmousemove",this.p)),this.m=!1)},addEventListener:function(t,e){this.r[t][this.Q++]=e},removeEventListener:function(t,e){var a;t=this.r[t];var s=[];for(a in t)t.hasOwnProperty[a]&&t[a]===e&&s.push(a);for(e=0;e<s.length;e++)delete t[a=s[e]]},b:[new y.hash.sha256],j:[0],z:0,q:{},J:0,F:{},R:0,g:0,f:0,O:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],s:void 0,t:6,m:!1,r:{progress:{},seeded:{}},Q:0,B:[0,48,64,96,128,192,256,384,512,768,1024],u:function(){for(var t=0;t<4&&(this.d[t]=this.d[t]+1|0,!this.d[t]);t++);return this.s.encrypt(this.d)},L:function(){this.a=this.u().concat(this.u()),this.s=new y.cipher.aes(this.a)},T:function(t){for(this.a=y.hash.sha256.hash(this.a.concat(t)),this.s=new y.cipher.aes(this.a),t=0;t<4&&(this.d[t]=this.d[t]+1|0,!this.d[t]);t++);},U:function(t){var e,a=[],s=0;for(this.O=a[0]=(new Date).valueOf()+3e4,e=0;e<16;e++)a.push(4294967296*Math.random()|0);for(e=0;e<this.b.length&&(a=a.concat(this.b[e].finalize()),s+=this.j[e],this.j[e]=0,t||!(this.z&1<<e));e++);this.z>=1<<this.b.length&&(this.b.push(new y.hash.sha256),this.j.push(0)),this.f-=s,s>this.g&&(this.g=s),this.z++,this.T(a)},p:function(t){y.random.addEntropy([t.x||t.clientX||t.offsetX,t.y||t.clientY||t.offsetY],2,"mouse")},o:function(){y.random.addEntropy(new Date,2,"loadtime")},K:function(t,e){var a;t=y.random.r[t];var s=[];for(a in t)t.hasOwnProperty(a)&&s.push(t[a]);for(a=0;a<s.length;a++)s[a](e)}},y.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,e,a,s){a=a||{},s=s||{};var n=y.json,i=n.c({iv:y.random.randomWords(4,0)},n.defaults);if(n.c(i,a),"string"==typeof i.salt&&(i.salt=y.codec.base64.toBits(i.salt)),"string"==typeof i.iv&&(i.iv=y.codec.base64.toBits(i.iv)),!y.mode[i.mode]||!y.cipher[i.cipher]||"string"==typeof t&&i.iter<=100||64!==i.ts&&96!==i.ts&&128!==i.ts||128!==i.ks&&192!==i.ks&&256!==i.ks||i.iv.length<2||4<i.iv.length)throw new y.exception.invalid("json encrypt: invalid parameters");return"string"==typeof t&&(t=(a=y.misc.cachedPbkdf2(t,i)).key.slice(0,i.ks/32),i.salt=a.salt),"string"==typeof e&&(e=y.codec.utf8String.toBits(e)),a=new y.cipher[i.cipher](t),n.c(s,i),s.key=t,i.ct=y.mode[i.mode].encrypt(a,e,i.iv,i.adata,i.tag),n.encode(n.V(i,n.defaults))},decrypt:function(t,e,a,s){a=a||{},s=s||{};var n=y.json;if("string"==typeof(e=n.c(n.c(n.c({},n.defaults),n.decode(e)),a,!0)).salt&&(e.salt=y.codec.base64.toBits(e.salt)),"string"==typeof e.iv&&(e.iv=y.codec.base64.toBits(e.iv)),!y.mode[e.mode]||!y.cipher[e.cipher]||"string"==typeof t&&e.iter<=100||64!==e.ts&&96!==e.ts&&128!==e.ts||128!==e.ks&&192!==e.ks&&256!==e.ks||!e.iv||e.iv.length<2||4<e.iv.length)throw new y.exception.invalid("json decrypt: invalid parameters");return"string"==typeof t&&(t=(a=y.misc.cachedPbkdf2(t,e)).key.slice(0,e.ks/32),e.salt=a.salt),a=new y.cipher[e.cipher](t),a=y.mode[e.mode].decrypt(a,e.ct,e.iv,e.adata,e.tag),n.c(s,e),s.key=t,y.codec.utf8String.fromBits(a)},encode:function(t){var e,a="{",s="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new y.exception.invalid("json encode: invalid property name");switch(a+=s+e+":",s=",",typeof t[e]){case"number":case"boolean":a+=t[e];break;case"string":a+='"'+escape(t[e])+'"';break;case"object":a+='"'+y.codec.base64.fromBits(t[e],1)+'"';break;default:throw new y.exception.bug("json encode: unsupported type")}}return a+"}"},decode:function(t){if(!(t=t.replace(/\s/g,"")).match(/^\{.*\}$/))throw new y.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var e,a,s={};for(e=0;e<t.length;e++){if(!(a=t[e].match(/^([a-z][a-z0-9]*):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new y.exception.invalid("json decode: this isn't json!");s[a[1]]=a[2]?parseInt(a[2],10):a[1].match(/^(ct|salt|iv)$/)?y.codec.base64.toBits(a[3]):unescape(a[3])}return s},c:function(t,e,a){if(void 0===t&&(t={}),void 0===e)return t;var s;for(s in e)if(e.hasOwnProperty(s)){if(a&&void 0!==t[s]&&t[s]!==e[s])throw new y.exception.invalid("required parameter overridden");t[s]=e[s]}return t},V:function(t,e){var a,s={};for(a in t)t.hasOwnProperty(a)&&t[a]!==e[a]&&(s[a]=t[a]);return s},W:function(t,e){var a,s={};for(a=0;a<e.length;a++)void 0!==t[e[a]]&&(s[e[a]]=t[e[a]]);return s}},y.encrypt=y.json.encrypt,y.decrypt=y.json.decrypt,y.misc.S={},y.misc.cachedPbkdf2=function(t,e){var a,s=y.misc.S;return a=(e=e||{}).iter||1e3,(a=(s=s[t]=s[t]||{})[a]=s[a]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):y.random.randomWords(2,0)})[s=void 0===e.salt?a.firstSalt:e.salt]=a[s]||y.misc.pbkdf2(t,s,e.iter),{key:a[s].slice(0),salt:s.slice(0)}},t.exports=y},function(t,e,a){"use strict";var d=a(0),s=new function(){var m=this;this.open=!1,this.dataNmlist={},this.dataIdlist={},this.Add=function(t,e,a){a=a||d.decode(e,!0),this.data[t]=[e,[],1],this.dataNmlist[a]=t,this.dataIdlist[t]=a},this.SortByUses=function(){var t=[];for(var e in this.data)t.push({id:parseInt(e,10),uses:this.data[e][this.defn.uses]});t.sort(function(t,e){return e.uses-t.uses});for(var a=0;a<t.length;a++)t[a]=t[a].id;return t},this.IDs2Names=function(t,e){var a,s=[];if(t&&t instanceof Array)for(var n=0;n<t.length;n++)isNaN(t[n])?!1!==(a=d.decode(t[n],!0))&&s.push((e||"")+a):this.dataIdlist[t[n]]&&s.push((e||"")+this.dataIdlist[t[n]]);return s.sort()},this.IDs2Str=function(t){return 0<(t=this.IDs2Names(t)).length?t.join(" "):""},this.Names2IDs=function(t,e){var a=[];if(t&&t instanceof Array)for(var s=[],n=null,i=0;i<t.length;i++){var o=t[i].slice(0,100);s.has(o)||(this.dataNmlist[o]?a.push(this.dataNmlist[o]):e||!1===(n=d.encode(o,!0))||a.push(n),s.push(o))}return a},this.Str2IDs=function(t,e){return this.Names2IDs(this.Str2Names(t),e)},this.Str2Names=function(t){var e=[];return t&&t.match&&(t=t.match(/(\S+)/g))&&t instanceof Array&&t.forEach(function(t){e.has(t)||e.push(t)}),e},this.StrParse=function(t){var i=[],o=[],d=[],r=[],l=[],c=[],h=[];return this.Str2Names(t).sort().forEach(function(t){var e=t.charAt(0),a="-"===e,s=":"===e;if((a||s)&&(t=t.slice(1)),t)if(s)h.push(t);else{var n=m.dataNmlist[t];n?a?(o.push(n),r.push(t)):(i.push(n),d.push(t)):a?c.push(t):l.push(t)}}),{tinc:i,texc:o,ninc:d,nexc:r,winc:l,wexc:c,wcmd:h}},this.StrBuild=function(t){var e=[];return t.wcmd&&t.wcmd instanceof Array&&t.wcmd.sort().forEach(function(t){e.push(":"+t)}),t.ninc&&t.ninc instanceof Array&&t.ninc.sort().forEach(function(t){e.push(t)}),t.nexc&&t.nexc instanceof Array&&t.nexc.sort().forEach(function(t){e.push("-"+t)}),t.winc&&t.winc instanceof Array&&t.winc.sort().forEach(function(t){e.push(t)}),t.wexc&&t.wexc instanceof Array&&t.wexc.sort().forEach(function(t){e.push("-"+t)}),e.join(" ")},this.Linked=function(t){var e,a=[],s={};if(t&&t instanceof Array)if(1===t.length)a=this.data[t[0]][this.defn.links];else for(e in t.forEach(function(t){m.data[t][m.defn.links].forEach(function(t){s[t]=(s[t]?s[t]:0)+1})}),s)s[e]===t.length&&a.push(parseInt(e,10));return a},this.Init=function(t){for(var e in this.data=t.data,this.defn=t.defn,this.data){var a=d.decode(this.data[e][this.defn.name]);this.dataNmlist[a]=e=parseInt(e,10),this.dataIdlist[e]=a}}};t.exports=s},function(t,e,a){"use strict";var g=a(0),i=a(1),v=a(5),y=a(3),s=new function(){var d=this,u=function(t){return t.ctrlKey?NoteFilter.TagSubtract(this.tagnm):this.finc?NoteFilter.TagInclude(this.tagnm):NoteFilter.TagExclude(this.tagnm),!1};this.UpdateCtrlBlock=function(t){if(!t){var e=this.GetNotesVisible();elchild(elclear(d.dom.tpinfo),[element("span",{className:"amount"},[element("p",{},"notes "),element("b",{title:"the limited amount of visible notes received according the search options (usually the first 20)"},e.length)," of ",element("span",{title:"the general amount of notes satisfying the giving search options"},this.data.total),e.length<this.data.notes.length?[element("p",{className:"div"},"|"),element("b",{title:"the amount of notes excluded from the note list due to the search filter"},this.data.notes.length-e.length)," filtered"]:null,this.data.notes.length<this.data.total?[element("p",{className:"div"},"|"),element("a",{},"load all",{onclick:function(){NoteFilter.NotesRequest(!0)}})]:null]),element("span",{},[element("p",{},"select "),element("a",{},"all",{onclick:function(){d.SetNotesState(e,"marked",!0),d.UpdateCtrlBlock(!0)}}),element("p",{className:"div"},"|"),element("a",{},"none",{onclick:function(){d.SetNotesState(e,"marked",!1),d.UpdateCtrlBlock(!0)}}),element("p",{className:"div"},"|"),element("a",{},"invert",{onclick:function(){d.SetNotesState(e,"marked"),d.UpdateCtrlBlock(!0)}})])])}var a=this.GetNotesByState("marked");this.dom.btndelete.style.display="none",this.dom.btnrestore.style.display="none",0<a.length&&((NoteFilter.data.wcmd.has("deleted")?this.dom.btnrestore:this.dom.btndelete).style.display="block"),this.dom.tpbar.style.display=0===this.data.total?"none":"block"},this.ClearNotesState=function(t){var e,a=t||d.dom.notes.childNodes;for(e=0;e<a.length;e++)a[e].className="note",a[e].state.active=a[e].state.marked=!1},this.SetNotesState=function(t,e,a){0<t.length&&t.forEach(function(t){t.state[e]=void 0!==a?a:!t.state[e],t.classList.toggle(e,t.state[e])})},this.GetNotesByState=function(t){var e,a=[],s=d.dom.notes.childNodes;for(e=0;e<s.length;e++)!0===s[e].state[t]&&a.push(s[e]);return a},this.GetNoteByID=function(t){for(var e=0,a=this.dom.notes.childNodes;e<a.length;e++)if(a[e].data.id===t)return a[e];return!1},this.GetNotesVisible=function(){for(var t=0,e=[],a=this.dom.notes.childNodes;t<a.length;t++)a[t].style.display||e.push(a[t]);return e};var p=function(t){if(t.ctrlKey)d.SetNotesState([this],"marked");else{var e=d.GetNotesByState("active"),a=0<e.length&&e[0].data.id===this.data.id,s=NoteEditor.HasChanges();if(!s||a||s&&NoteEditor.ConfirmExit())if(d.ClearNotesState(),NoteEditor.GetNoteID()!==this.data.id&&NoteEditor.Load(this.data),d.SetNotesState([this],"active"),t.shiftKey){var n,i,o=!1;for(n=0;n<d.dom.notes.childNodes.length;n++)(i=d.dom.notes.childNodes[n]).data.id!==e[0].data.id&&i.data.id!==this.data.id||(o=!o),(o||i.data.id===e[0].data.id||i.data.id===this.data.id)&&d.SetNotesState([i],"marked")}else d.SetNotesState([this],"marked")}d.UpdateCtrlBlock()},f=function(){return d.SetNotesState([this.note],"marked"),d.UpdateCtrlBlock(),!1};this.BuildNote=function(t){var e,a,s,n,i,o,d,r,l,c,h,m=element("div",{className:"note",data:t,dom:{},state:{}});return elchild(m,[element("div",{className:"icon"},[m.dom.icon=element("img",{className:"icon",src:(c=t,h="img/tags/note.svg",y.IDs2Names(c.tags).forEach(function(e){v.some(function(t){return t.name===e})&&(h="img/tags/"+e+".svg")}),h)}),m.dom.tick=element("div",{className:"tick",note:m})]),element("div",{className:"body"},[m.dom.info=element("div",{className:"info"},(i=t,o=m.dom.icon,d=[],r=[],l=null,i.entries.forEach(function(t){var e=g.decode(t.name),a=g.decode(t.data);if(r.push(e.toLowerCase()),r.push(a.toLowerCase()),4!==t.id_type&&a){var s=30<e.length?e.slice(0,25)+"...":e,n=50<a.length?a.slice(0,35)+"...":a;2===t.id_type&&((0<=a.search("http://")||0<=a.search("https://")||0<=a.search("ftp://"))&&0<=a.search(".")?(n=element("a",{target:"_blank",href:a},n),l||(l=a)):n=element("b",{},n)),d.push(element("span",{className:"name"},s+":")),d.push(element("span",{className:"data"},n))}}),l&&(l=l.split("/"))[2]&&"localhost"!==l[2]&&element("img",{className:"icon",src:"http://www.getfavicon.org/get.pl?url="+l[2]},null,{onload:function(){var t=o.parentNode;t.removeChild(o),elchild(t,this)}}),i.fulltext=r.join("\n"),0<d.length?d:element("div",{className:"warn"},"there is no data"))),m.dom.tags=element("div",{className:"tags"},(e=t,a=[],s=[],n=[],0<e.tags.length&&(e.tags.forEach(function(t){NoteFilter.data.tinc.has(t)?n.push(y.dataIdlist[t]):s.push(y.dataIdlist[t])}),n.sort().forEach(function(t){(t=element("span",{className:"tag include",tagnm:t,title:"click on this tag to exclude it from the search"},t)).addEventListener("click",u),a.push(t)}),s.sort().forEach(function(t){(t=element("span",{className:"tag",finc:!0,tagnm:t,title:"click on this tag to include it to the search"},t)).addEventListener("click",u),a.push(t)})),0<a.length?a:"there are no tags"))])]),m.addEventListener("click",p),m.dom.tick.addEventListener("click",f),m},this.SetNotesVisibility=function(e){e=e||this.dom.notes.childNodes;var a,s,t=[];for(a=0;a<e.length;a++)(s=!0)&&(NoteFilter.data.winc.forEach(function(t){e[a].data.fulltext.indexOf(t.toLowerCase())<0&&(s=!1)}),s&&NoteFilter.data.wexc.forEach(function(t){0<=e[a].data.fulltext.indexOf(t.toLowerCase())&&(s=!1)})),e[a].style.display=s?"":"none",s||t.push(e[a]);this.ClearNotesState(t),this.UpdateCtrlBlock()},this.BuildTable=function(t,e){if(t=t instanceof Array?t:[],this.data.notes=t,this.data.total=e,elclear(this.dom.notes),0<e){var a,s=NoteEditor.GetNoteID();t.forEach(function(t){a=d.BuildNote(t),d.SetNotesVisibility([a]),elchild(d.dom.notes,a),s===t.id&&d.SetNotesState([a],"active")})}this.UpdateCtrlBlock()};var e=function(){if(confirm(this.undo?"You are going to restore all checked notes in the note list. Do you really want to continue?":"You are going to delete all checked notes in the note list. Do you really want to continue?")){var e=[];d.GetNotesByState("marked").forEach(function(t){t.data.id&&e.push(t.data.id)}),s=e,n=this.undo,0<s.length&&i.post("note/delete"+(n?"/undo":""),{ids:s},function(t,e){if(NoteFilter.MsgClear(),e.error)NoteFilter.MsgAdd("The request was not successful. The response from the server: "+e.error,"error");else{var a=[(n?"The selected notes were successfully restored ":"The selected notes were successfully removed ")+"(amount:"+e.count+"). "];n||a.push(" It is still possible to ",element("a",{className:"bold"},"restore them",{onclick:function(){NoteFilter.RequestDeleted()}})),s.has(NoteEditor.GetNoteID())&&NoteEditor.Escape(),NoteFilter.MsgAdd(a),NoteFilter.NotesRequest()}})}var s,n};this.Init=function(t){t.handle&&(this.dom={handle:t.handle},this.data={total:0,notes:[]},elchild(this.dom.handle,[this.dom.tpbar=element("div",{className:"tpbar"},[this.dom.tpctrl=element("div",{className:"ctrl"},[this.dom.btndelete=element("input",{type:"button",value:"Delete",undo:!1,className:"button hidden"},null,{onclick:e}),this.dom.btnrestore=element("input",{type:"button",value:"Restore",undo:!0,className:"button hidden"},null,{onclick:e})]),this.dom.tpinfo=element("div",{className:"info"})]),this.dom.notes=element("div",{className:"notes"})]))}};t.exports=s},function(t,e,a){"use strict";t.exports=[{name:"note",description:"simple note with title and text",entries:[{id:1,name:"title"},{id:6,name:"description"}]},{name:"site",description:"regular site bookmark",entries:[{id:2,name:"site url"},{id:5,name:"email"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"email",description:"email address record",entries:[{id:2,name:"site url"},{id:5,name:"email"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"messenger",description:"instant messenger account information",entries:[{id:2,name:"site url"},{id:5,name:"email"},{id:3,name:"username"},{id:4,name:"password"},{id:1,name:"phone"},{id:6,name:"comments"}]},{name:"ftp",description:"ftp server data",entries:[{id:2,name:"server address"},{id:3,name:"username"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"ssh",description:"ssh server data",entries:[{id:2,name:"server address"},{id:3,name:"username"},{id:4,name:"password"},{id:6,name:"comments"}]},{name:"database",description:"database access parameters",entries:[{id:2,name:"server address"},{id:1,name:"database name"},{id:3,name:"username"},{id:4,name:"password"},{id:6,name:"comments"}]}]},function(t,e,a){"use strict";var s=a(5),n=new function(){var a=this,e="In the list above please select a template to be used to create your new note.";this.Fill=function(){elclear(a.dom.list),s.forEach(function(t){var e=element("div",{className:"item",data:t},element("div",{className:"line "+t.name},[element("div",{className:"name"},t.name),element("div",{className:"hint"},t.description)]));elchild(a.dom.list,e),e.addEventListener("click",function(){a.Show(!1),NoteEditor.Create(this.data)}),e.addEventListener("mouseenter",function(){var e=[];t.entries.forEach(function(t){e.push("<b>"+t.name+"</b>")}),a.dom.hint.innerHTML="This template will create a note with this set of entries:<br>"+e.join(", ")})})},this.Show=function(t){this.dom.handle.style.display=t?"block":"none"},this.Init=function(t){t.handle&&(this.dom={handle:t.handle},elchild(this.dom.handle,[this.dom.title=element("div",{className:"title"}),this.dom.list=element("div",{className:"list"}),this.dom.hint=element("div",{className:"hint"},e)]),this.dom.handle.addEventListener("mouseleave",function(){a.dom.hint.innerHTML=e}),elchild(this.dom.title,[element("div",{className:"text"},"Templates")]),this.Fill())}};t.exports=n},function(t,e,a){"use strict";var s,n=a(0),i=a(2),o=a(1),d=a(4),r=a(6),l=a(3);a(8),a(9),a(11),a(12),window.Logout=function(){o.post("user/logout",null,function(t,e){t||location.reload()})},window.initData=function(t,e,a){n.setPass(e),window.dataUser=t,o.get("user/tags",function(t,e){t||(l.Init(e),d.Init({handle:document.querySelector("div.notelist")}),NoteFilter.Init({handle:document.querySelector("div.notefilter")}),r.Init({handle:document.querySelector("div.templatelist")}),NoteEditor.Init({handle:document.querySelector("div.noteeditor")}),window.pageMain.style.display="block",a())})},window.exportData=null,window.pageMain=document.getElementById("pageMain"),i.random.startCollectors(),s=setInterval(function(){i.random.isReady()&&(i.random.stopCollectors(),clearInterval(s))},1e3),o.get("user/info",function(t,e){e?(window.dataUser=e,n.setPassHash(e.hash),DlgPassGet.Show({escClose:!1})):DlgUserLogin.Show({escClose:!1})})},function(t,e,a){"use strict";var o=a(1),d=a(4),r=a(3),s=new function(){var n=this,a="click on this word to remove it from the filtering";this.MsgClear=function(){elclear(this.dom.messages)},this.MsgAdd=function(t,e){elchild(this.dom.messages,element("div",{className:e||"info"},t))},this.SetFocus=function(){this.dom.input.focus()};this.RequestLatest=function(){this.Reset(),this.NotesRequest()},this.RequestDeleted=function(){this.MsgClear(),this.dom.input.value=":deleted",this.UpdateParsedInput(),this.NotesRequest()},this.NotesRequest=function(t){for(var e in n.dom.icon.className="icon loading",n.dom.messages.className="messages loading",this.data)this.post[e]=this.data[e].slice();o.post("note/search",{tinc:this.post.tinc,texc:this.post.texc,wcmd:this.post.wcmd,all:t},function(t,e){e.error?n.MsgAdd("The request was not successful. The response from the server: "+e.error,"fail"):(d.BuildTable(e.notes,e.total),0===e.total&&(n.data.tinc.length||n.data.texc.length||n.data.wcmd.length)&&n.MsgAdd(["There are no records to meet the given search options. You can change these options or see your ",element("a",{className:"bold"},"latest notes",{onclick:function(){n.RequestLatest()}})])),n.dom.icon.className="icon",n.dom.messages.className="messages"})},this.UpdateParsedInput=function(){this.dom.input.value.trim()!==this.dom.input.data.oldval.trim()&&(this.data=r.StrParse(this.dom.input.value),this.dom.input.data.oldval=this.dom.input.value)},this.DoSearch=function(t){var e=this.dom.input.data;this.UpdateParsedInput(),0!==e.history.length&&e.history[e.history.length-1]===this.dom.input.value||(e.history.push(this.dom.input.value),e.histpos=e.history.length),t&&(this.dom.input.data.oldval=this.dom.input.value=r.StrBuild(this.data)),i()};var i=function(){if(n.MsgClear(),n.data.tinc.sort().join()!=n.post.tinc.sort().join()||n.data.texc.sort().join()!=n.post.texc.sort().join()||n.data.wcmd.sort().join()!=n.post.wcmd.sort().join()||""==n.dom.input.value.trim()?n.NotesRequest():d.SetNotesVisibility(),0<n.data.winc.length||0<n.data.wexc.length){var e=[];n.data.winc.sort().forEach(function(t){e.push(element("a",{title:a,word:t,fexc:!1},t,{onclick:s}))}),n.data.wexc.sort().forEach(function(t){e.push(element("a",{title:a,word:t,fexc:!0},"-"+t,{onclick:s}))}),n.MsgAdd(["Here is the list of words used which are not your tags:",e,". It was used for text filtering."])}};this.TagInclude=function(t){var e=r.dataNmlist[t];e&&!this.data.tinc.has(e)&&(this.data.tinc.push(e),this.data.ninc.push(t),this.dom.input.data.oldval=this.dom.input.value=r.StrBuild(this.data)),i()},this.TagExclude=function(t){var e=r.dataNmlist[t];if(e&&this.data.tinc.has(e)){var a=this.data.tinc.indexOf(e),s=this.data.ninc.indexOf(t);0<=a&&this.data.tinc.splice(a,1),0<=s&&this.data.ninc.splice(s,1),this.dom.input.data.oldval=this.dom.input.value=r.StrBuild(this.data)}i()},this.TagSubtract=function(t){var e=r.dataNmlist[t];if(e&&!this.data.texc.has(e)){var a=this.data.tinc.indexOf(e),s=this.data.ninc.indexOf(t);0<=a&&this.data.tinc.splice(a,1),0<=s&&this.data.ninc.splice(s,1),this.data.texc.push(e),this.data.nexc.push(t),this.dom.input.data.oldval=this.dom.input.value=r.StrBuild(this.data)}i()};var s=function(){var t=this.fexc?n.data.wexc:n.data.winc,e=t.indexOf(this.word);0<=e&&(t.splice(e,1),this.parentNode.removeChild(this),0===n.data.winc.length&&0===n.data.wexc.length&&n.MsgClear(),n.dom.input.data.oldval=n.dom.input.value=r.StrBuild(n.data),d.SetNotesVisibility())};this.Reset=function(){this.dom.input.data.oldval=this.dom.input.value="",n.dom.input.focus(),this.data=r.StrParse(),this.post=r.StrParse(),n.MsgClear()},this.Init=function(t){t.handle&&(this.dom={handle:t.handle},this.data=r.StrParse(),this.post=r.StrParse(),elchild(this.dom.handle,[element("div",{className:"search"},[this.dom.home=element("div",{className:"home"},element("div",{title:"reset all search parameters and filters and request the latest active notes"},null,{onclick:function(){n.RequestLatest()}})),this.dom.input=element("input",{className:"line",placeholder:"search by tags or content ...",type:"text",data:{encval:"",oldval:"",history:[],histpos:0}}),this.dom.icon=element("div",{className:"icon"})]),this.dom.messages=element("div",{className:"messages"})]),$(this.dom.input).autocomplete({matchInside:!1,selectFirst:!0,useDelimiter:!0,delimiterChar:" ",delimiterKeyCode:32,minChars:1,autoWidth:"width",delay:200,data:[!0],showResult:function(t){return t},processData:function(t){if(0<t.length&&(n.UpdateParsedInput(),t=[],n.data.wcmd.has("deleted")||t.push([":deleted",0]),n.data.wcmd.has("notags")||t.push([":notags",0]),n.data.wcmd.has("day")||n.data.wcmd.has("week")||n.data.wcmd.has("month")||t.push([":day",0],[":week",0],[":month",0]),!n.data.wcmd.has("notags"))){var e=[];for(var a in 0<n.data.tinc.length&&(e=r.Linked(n.data.tinc)),r.dataNmlist){var s=r.dataNmlist[a];(0===n.data.tinc.length||e.has(s))&&(n.data.tinc.has(s)||n.data.texc.has(s)||t.push([a,s],["-"+a,s]))}}return t}}),this.ac=$(this.dom.input).data("autocompleter"),this.dom.input.addEventListener("keydown",function(t){if(13===t.keyCode&&n.DoSearch(t.ctrlKey),38===t.keyCode&&!n.ac.active_&&0<this.data.histpos){for(;this.data.history[--this.data.histpos]&&this.data.history[this.data.histpos].trim()===this.value.trim(););0<=this.data.histpos&&(this.value=this.data.history[this.data.histpos])}if(40===t.keyCode&&!n.ac.active_&&this.data.histpos<this.data.history.length-1){for(;this.data.history[++this.data.histpos]&&this.data.history[this.data.histpos].trim()===this.value.trim(););this.data.histpos<this.data.history.length&&(this.value=this.data.history[this.data.histpos])}t.ctrlKey&&32===t.keyCode&&n.ac.activate()}),i(),d.UpdateCtrlBlock(!0))}};window.NoteFilter=s,t.exports=s},function(t,e,a){"use strict";var m=a(0),s=a(1),u=a(4),p=a(6),f=a(3),g=a(5),v=a(10);window.NoteEditor=new function(){var i=this,o=!1,t="Will save all your changes. You can also press Ctrl+Enter",n=function(t,e){if(e=e||[],(t=f.Str2Names(t)).length!==e.length)return!0;for(var a=null,s=0;s<t.length;s++){if(!(a=f.dataNmlist[t[s]]))return!0;if(!e.has(a))return!0}return!1};this.Save=function(){this.HasChanges()&&(l(!1),s.post("note/save/"+(this.data.id||""),function(){var t=0,e=null,a=[],s=[];for(i.data.tags=f.Str2IDs(i.dom.tags.input.value.toLowerCase()),i.data.tags.join()!==i.post.tags.join()?i.post.tags=0===i.data.tags.length?0:i.data.tags.slice():delete i.post.tags,i.post.entries=[],t=0;t<i.dom.entries.childNodes.length;t++)i.dom.entries.childNodes[t].deleted&&a.push(i.dom.entries.childNodes[t]);for(t=0;t<a.length;t++)a[t].data.id&&s.push(a[t].data.id),i.dom.entries.removeChild(a[t]);for(0<s.length&&(i.post.deleted=s),t=0;t<i.dom.entries.childNodes.length;t++){var n={};(e=i.dom.entries.childNodes[t]).data.id&&(n.id=e.data.id),e.post.id_type===e.data.id_type&&void 0!==e.data.id||(n.id_type=e.data.id_type),e.post.name_dec===e.dom.name.value&&void 0!==e.data.id||(e.data.name=n.name=e.data.name_dec===e.dom.name.value?e.data.name:m.encode(e.dom.name.value),e.data.name_dec=e.dom.name.value),e.post.data_dec===e.dom.data.value&&void 0!==e.data.id||(e.data.data=n.data=e.data.data_dec===e.dom.data.value?e.data.data:m.encode(e.dom.data.value),e.data.data_dec=e.dom.data.value),e.dom.type.style.display="none",e.dom.history.style.display="none",elclear(e.dom.history),delete e.data.history,i.post.entries.push(n)}return i.post}(),function(t,e){if(e&&e.id&&e.entries){i.data.id;i.data.id=e.id;for(var a=[],s=0;s<i.dom.entries.childNodes.length;s++){var n=i.dom.entries.childNodes[s];n.data.id=e.entries[s].id,n.post.name=n.data.name,n.post.name_dec=n.data.name_dec,n.post.data=n.data.data,n.post.data_dec=n.data.data_dec,n.post.id_type=n.data.id_type,n.dom.name.classList.remove("changed"),n.dom.data.classList.remove("changed"),i.dom.tags.input.classList.remove("changed"),e.entries[s].changed&&(n.dom.icon.src="img/field_flag_ok.png"),e.entries[s].added&&(n.dom.icon.src="img/field_flag_add.png"),a.push(n.data)}if(i.data.entries=a,e.tags){if(e.tags instanceof Array&&i.data.tags.length===e.tags.length)for(s=0;s<e.tags.length;s++)isNaN(i.data.tags[s])&&(f.Add(e.tags[s],i.data.tags[s]),i.data.tags[s]=e.tags[s]);i.dom.tags.icon.src="img/field_flag_ok.png"}i.dom.tags.input.value=f.IDs2Str(i.data.tags).toLowerCase(),i.post.tags=i.data.tags.slice(),delete i.post.deleted,setTimeout(function(){for(var t=0;t<i.dom.entries.childNodes.length;t++){var e=i.dom.entries.childNodes[t];e.dom.icon.src="img/field_"+v.hash[e.data.id_type].name+".png"}i.dom.tags.icon.src="img/field_tag.png"},2e3),o=!1,NoteFilter.NotesRequest()}l(!0),c()}))};this.ProceedUrlIcon=function(t){t&&t.query&&t.query.results};var d=function(n){n.dom.btn_config=element("img",{src:"img/settings.svg",className:"button",title:"change entry type"},null,{onclick:function(){!function(e){if(0===e.dom.type.childNodes.length){var t=table(1,0,{className:"list"},{onmouseout:function(){e.dom.desc.innerHTML=e.dom.desc.value}}),a=null;for(var s in v.hash)s=parseInt(s,10),(a=element("td",{className:e.data.id_type===s?"current":"item"},v.hash[s].name,{onmouseover:function(){e.dom.desc.innerHTML=this.desc},onclick:function(){if("item"==this.className){e.dom.name.value=v.hash[this.type].name,e.data.id_type=this.type,e.data.name=m.encode(e.dom.name.value),e.data.name_dec=e.dom.name.value,e.data.data=m.encode(e.dom.data.value),e.data.data_dec=e.dom.data.value;var t=r(e.data);t.post=e.post,t.dom.name.onchange(),t.dom.data.onchange(),i.dom.entries.insertBefore(t,e),i.dom.entries.removeChild(e),o=!0}}})).type=s,a.name=v.hash[s].name,a.desc=v.hash[s].description,elchild(t,a);elchild(e.dom.type,t)}e.dom.type.style.display="block"!==e.dom.type.style.display?"block":"none"}(n)}}),n.dom.btn_history=element("img",{src:"img/history.svg",className:"button",title:"show/hide entry hisory values"},null,{onclick:function(){var o;(o=n).data.history||(i.data.id&&o.data.id?(elchild(elclear(o.dom.history),element("div",{className:"info"},"loading ...")),s.get("note/history/"+i.data.id+"/"+o.data.id,function(t,e){if(!t){elclear(o.dom.history),o.data.history=e;var a=element("table",{className:"maxw"});if(e.data.length){for(var s=0;s<e.data.length;s++){var n=e.data[s][e.defn.name]?m.decode(e.data[s][e.defn.name]):"",i=e.data[s][e.defn.data]?m.decode(e.data[s][e.defn.data]):"";tblrow(a,[element("span",{title:n},20<n.length?n.slice(0,15)+"...":n),element("span",{title:i},30<i.length?i.slice(0,25)+"...":i),element("a",{name:n,data:i},"use",{onclick:function(){o.dom.name.value=this.name,o.dom.data.value=this.data,o.dom.name.onchange(),o.dom.data.onchange(),o.dom.history.style.display="none"}})],[{className:"name"},{className:"data"},{className:"ctrl"}])}elchild(elclear(o.dom.history),a)}else elchild(elclear(o.dom.history),element("div",{className:"info"},"there are no history records for this entry"))}})):(o.data.history=[],elchild(elclear(o.dom.history),element("div",{className:"info"},"there are no history records for this entry")))),o.dom.history.style.display="block"!==o.dom.history.style.display?"block":"none"}}),n.dom.btn_add=element("img",{src:"img/add.svg",className:"button",title:"add new entry after this one"},null,{onclick:function(){var t,e,a,s;t=n,e=v.hash[t.data.id_type].name,a=4==t.data.id_type?pwdgen(20):"",s=r({id_type:t.data.id_type,name:m.encode(e),name_dec:e,data:m.encode(a),data_dec:a}),i.dom.entries.insertBefore(s,t),s.dom.name.classList.add("changed"),s.dom.data.classList.add("changed"),o=!0}}),n.dom.btn_up=element("img",{src:"img/arrow_up.svg",className:"button",title:"move this entry one row up"},null,{onclick:function(){var t;(t=n).previousSibling&&(i.dom.entries.insertBefore(t,t.previousSibling),o=!0)}}),n.dom.btn_down=element("img",{src:"img/arrow_down.svg",className:"button",title:"move this entry one row down"},null,{onclick:function(){var t;(t=n).nextSibling&&(i.dom.entries.insertBefore(t,t.nextSibling.nextSibling),o=!0)}}),n.dom.btn_delete=element("img",{src:"img/clear.svg",className:"button",title:"delete this entry"},null,{onclick:function(){var t;t=n,1<i.dom.entries.childNodes.length&&(t.dom.undo.classList.toggle("hidden"),t.dom.body.classList.toggle("hidden"),t.deleted=!0,o=!0)}});var t=[];return 4===n.data.id_type&&(n.dom.btn_pwdgen=element("img",{src:"img/refresh.svg",className:"button",title:"generate a new password"},null,{onclick:function(){n.dom.data.value=pwdgen(20),n.dom.data.onchange()}}),n.dom.btn_maskpwd=element("img",{src:"img/visibility_off.svg",className:"button",title:"Show password"},null,{onclick:function(){"text"===n.dom.data.type?(this.title="Show password",this.src="img/visibility_off.svg",n.dom.data.type="password"):(this.src="img/visibility.svg",this.title="Hide password",n.dom.data.type="text")}}),n.dom.data.type="password",t.push(n.dom.btn_maskpwd),t.push(n.dom.btn_pwdgen)),t.push(n.dom.btn_config,n.dom.btn_history,n.dom.btn_add,n.dom.btn_up,n.dom.btn_down,n.dom.btn_delete),n.dom.controls=element("div",{className:"hidden"},t)},r=function(t){var e,a,s=element("div",{className:"entry"});return s.dom={undo:element("div",{className:"undo hidden"}),body:element("div",{className:"body"})},s.data=t||{},s.post={id_type:t.id_type,name:t.name,name_dec:t.name_dec,data:t.data,data_dec:t.data_dec},function(e){e.dom.type=element("div",{className:"type"});var t=v.hash[e.data.id_type].max;6===e.data.id_type||7===e.data.id_type?(e.dom.data=element("textarea",{className:"text",maxLength:t},e.data.data_dec),e.dom.data.addEventListener("keydown",function(t){38===t.keyCode&&e.previousSibling&&0===this.selectionStart&&e.previousSibling.dom.data.focus(),40===t.keyCode&&e.nextSibling&&this.selectionStart===this.value.length&&e.nextSibling.dom.data.focus()})):(e.dom.data=element("input",{type:5===e.data.id_type?"email":"text",maxLength:t,className:5===e.data.id_type?"email":"line",value:e.data.data_dec}),e.dom.data.addEventListener("keydown",function(t){38===t.keyCode&&e.previousSibling&&e.previousSibling.dom.data.focus(),40===t.keyCode&&e.nextSibling&&e.nextSibling.dom.data.focus()})),e.dom.data.autocomplete="off",e.dom.data.onchange=function(){this.value=this.value.trim(),i.data.id&&(null!=e.post.data_dec&&e.post.data_dec!=this.value?this.classList.add("changed"):this.classList.remove("changed"))},e.dom.history=element("div",{className:"history"}),e.dom.data.onkeyup=function(){e.dom.counter.innerHTML=this.value.length,this.value.length>=this.maxLength&&"limit"!=e.dom.counter.className?e.dom.counter.className="limit":this.value.length<this.maxLength&&"limit"==e.dom.counter.className&&(e.dom.counter.className="")},e.dom.data.onkeydown=e.dom.data.onkeyup}(s),(e=s).dom.desc=element("span",{},v.hash[e.data.id_type].description),e.dom.desc.value=v.hash[e.data.id_type].description,e.dom.counter=element("span",{className:e.dom.data.value.length===e.dom.data.maxLength?"limit":""},e.dom.data.value.length),e.dom.hint=tblrow(element("table",{className:"hint"}),[e.dom.desc,e.dom.counter],[{className:"text"},{className:"counter"}]),d(s),(a=s).dom.name=element("input",{type:"text",maxLength:256,value:a.data.name_dec},"",{onchange:function(){this.value=this.value.trim(),i.data.id&&(null!==a.post.name_dec&&a.post.name_dec!==this.value?this.classList.add("changed"):this.classList.remove("changed"))}}),a.dom.name.addEventListener("keydown",function(t){38===t.keyCode&&a.previousSibling&&a.previousSibling.dom.name.focus(),40===t.keyCode&&a.nextSibling&&a.nextSibling.dom.name.focus()}),a.dom.icon=element("img",{src:"img/field_"+v.hash[a.data.id_type].name+".png"}),a.dom.title=tblrow(element("table",{className:"title"}),[a.dom.icon,a.dom.name,a.dom.controls],[{className:"icon"},{className:"name"},{className:"controls"}]),elchild(s.dom.body,[s.dom.title,s.dom.type,s.dom.data,s.dom.history,s.dom.hint]),elchild(s,[s.dom.undo,s.dom.body]),elchild(s.dom.undo,element("a",{},"restore deleted entry",{onclick:function(){s.dom.undo.classList.toggle("hidden"),s.dom.body.classList.toggle("hidden"),s.deleted=!1}})),s.addEventListener("mouseenter",function(){s.previousSibling?s.dom.btn_up.className="button":s.dom.btn_up.className="disabled",s.nextSibling?s.dom.btn_down.className="button":s.dom.btn_down.className="disabled",1===i.dom.entries.childNodes.length?s.dom.btn_delete.className="disabled":s.dom.btn_delete.className="button",s.dom.controls.classList.remove("hidden")}),s.addEventListener("mouseleave",function(){s.dom.controls.classList.add("hidden")}),s},l=function(t){if(i.dom.bcontrols)for(var e=i.dom.bcontrols.childNodes,a=0;a<e.length;a++)e[a].disabled=!t};this.ConfirmExit=function(){return confirm("The current note has unsaved changes. Do you really want to continue and lost these changes?")},this.Clone=function(){delete this.data.id,this.data.entries.forEach(function(t){delete t.id}),this.post.tags=[],o=!0,this.Save(),this.dom.entries.childNodes[0].dom.data.focus()},this.New=function(){var e,a,s=[];this.data.entries.forEach(function(t){e=v.hash[t.id_type].name,a=4==t.id_type?pwdgen(20):"",s.push({id_type:t.id_type,name:m.encode(e),name_dec:e,data:m.encode(a),data_dec:a})}),this.Escape(!0)&&(this.data.entries=s,h(),c(),o=!0,this.dom.entries.childNodes[0].dom.data.focus())},this.Escape=function(t){var e=NoteEditor.HasChanges();if(!e||e&&this.ConfirmExit()){var a=u.GetNoteByID(i.data.id);return!1!==a&&u.SetNotesState([a],"active",!1),elclear(this.dom.handle),this.data={tags:[],entries:[]},this.post={tags:[]},o=!1,t||(i.Show(!1),p.Show(!0)),!0}return!1},this.Create=function(t){this.data={tags:[],entries:[]},this.post={tags:[]};var e,a,s,n=this;t?(t.entries.forEach(function(t){a=4===t.id?pwdgen(20):"",n.data.entries.push({id_type:t.id,name:m.encode(t.name),name_dec:t.name,data:m.encode(a),data_dec:a})}),s=t.name,this.data.tags=f.Str2IDs(s)):(e=v.hash[1].name,a=s="",this.data.entries=[{id_type:1,name:m.encode(e),name_dec:e,data:m.encode(a),data_dec:a}]),h(),this.dom.tags.input.value=s.toLowerCase(),c(),this.dom.entries.childNodes[0].dom.data.focus()},this.Load=function(t){if(this.data=t,i.post={tags:t.tags?t.tags.slice():[]},t.id&&t.entries&&t.entries instanceof Array)for(var e=0;e<t.entries.length;e++){var a=t.entries[e];a.name_dec=m.decode(a.name),a.data_dec=m.decode(a.data)}else this.Create();h(),this.dom.tags.input.value=f.IDs2Str(this.data.tags).toLowerCase(),c()},this.GetNoteID=function(){return this.data&&this.data.id?this.data.id:null};var c=function(t){var e;t||(t="img/tags/note.svg",(e=i.dom.tags.input.value.toLowerCase().match(/(\S+)/g))&&e.forEach(function(e){g.some(function(t){return t.name===e})&&(t="img/tags/"+e+".svg")})),i.dom.title.icon.src.search(t)<0&&(i.dom.title.icon.src=t)},h=function(){o=!1,i.dom.title=element("div",{className:"caption"}),i.dom.title.icon=element("img",{width:32,height:32}),elchild(i.dom.title,tblrow(element("table",{className:"maxw"}),[i.dom.title.icon,[element("div",{className:"main"},"Note")],[i.data.ctime?element("div",{},"created: "+TimestampToDateStr(i.data.ctime)):"",i.data.mtime?element("div",{},"edited: "+TimestampToDateStr(i.data.mtime)):""]],[{className:"icon"},{className:"name"},{className:"info"}])),function(){i.dom.entries=element("div",{className:"entries"});for(var t=0;t<i.data.entries.length;t++)elchild(i.dom.entries,r(i.data.entries[t]));i.dom.entries}(),function(){var t=element("input",{type:"text",maxLength:1024,className:"line",value:""}),e=element("img",{src:"img/field_tag.png"});i.dom.tags=element("div",{className:"tags"},[tblrow(element("table",{className:"title"}),[e,"tags"],[{className:"icon"},{className:"name"}]),t,element("div",{className:"hint"},"list of associated tags separated by space")]),i.dom.tags.input=t,i.dom.tags.icon=e,t.onchange=function(){i.data.id&&(n(this.value,i.post.tags)?this.classList.add("changed"):this.classList.remove("changed"))};var a=[];for(var s in f.dataIdlist)a.push([f.dataIdlist[s],s]);$(i.dom.tags.input).autocomplete({matchInside:!1,selectFirst:!0,useDelimiter:!0,delimiterChar:" ",delimiterKeyCode:32,minChars:1,autoWidth:"width",delay:200,data:a,showResult:function(t){return t},processData:function(t){var e=[],a=i.dom.tags.input.value.toLowerCase().match(/(\S+)/g);return t.forEach(function(t){a.has(t[0])||e.push(t)}),e}}),i.dom.tags}(),i.dom.tcontrols=element("div",{className:"tbuttons"},[element("input",{type:"button",value:"Back",className:"button left",title:"Will discard all your current changes and show the template list."},null,{onclick:function(){i.Escape()}}),element("input",{type:"button",value:"New",className:"button left",title:"Will create a new note based on the current one."},null,{onclick:function(){i.New()}}),element("input",{type:"button",value:"Duplicate",className:"button left",title:"Will save the current note as a copy."},null,{onclick:function(){i.Clone()}}),element("input",{type:"button",value:"Save",className:"button bold",title:t},null,{onclick:function(){i.Save()}})]),i.dom.bcontrols=element("div",{className:"bbuttons"},[element("input",{type:"button",value:"Save",className:"button bold",title:t},null,{onclick:function(){i.Save()}})]),elclear(i.dom.handle),elchild(i.dom.handle,[i.dom.title,i.dom.tcontrols,i.dom.entries,element("div",{className:"divider"}),i.dom.tags,element("div",{className:"divider"}),i.dom.bcontrols]),p.Show(!1),i.Show(!0)};this.Show=function(t){this.dom.handle.style.display=t?"block":"none"},this.HasChanges=function(){var t,e,a=o;if(this.data&&this.data.entries&&0<this.data.entries.length&&!o){for(t=0;t<this.dom.entries.childNodes.length;t++)if(null!=(e=this.dom.entries.childNodes[t]).post.data_dec&&e.post.data_dec!=e.dom.data.value||null!=e.post.name_dec&&e.post.name_dec!=e.dom.name.value||e.post.id_type!=e.data.id_type){a=!0;break}!a&&n(this.dom.tags.input.value.toLowerCase(),this.post.tags)&&(a=!0)}return a},this.Init=function(t){t.handle&&(this.dom={handle:t.handle},this.onsave=t.onsave||null,this.oncancel=t.oncancel||null,i.dom.handle.addEventListener("keypress",function(t){13===t.keyCode&&t.ctrlKey&&i.Save()}),i.dom.handle.addEventListener("keydown",function(t){27===t.keyCode&&i.Escape()}))}}},function(t,e,a){"use strict";var s=[{id:1,max:1024,name:"line",icon:"https://image.flaticon.com/icons/svg/23/23187.svg",description:"title or short one line text description"},{id:2,max:2048,name:"uri",icon:"https://image.flaticon.com/icons/svg/117/117965.svg",description:"any addresses - http/https/ftp/ssh or file path"},{id:3,max:1024,name:"login",icon:"https://image.flaticon.com/icons/svg/149/149452.svg",description:"user name, login or email in some cases"},{id:4,max:4096,name:"password",icon:"https://image.flaticon.com/icons/svg/263/263069.svg",description:"any secret letters sequence"},{id:5,max:1024,name:"email",icon:"https://image.flaticon.com/icons/svg/60/60381.svg",description:"email address line"},{id:6,max:65535,name:"text",icon:"https://image.flaticon.com/icons/svg/140/140952.svg",description:"plain text entry for notes"},{id:7,max:65535,name:"html",icon:"https://image.flaticon.com/icons/svg/25/25252.svg",description:"formatted text entry for notes"}],n={};s.forEach(function(t){n[t.id]=t}),t.exports={list:s,hash:n}},function(t,e,a){var i=a(2);Array.prototype.has=function(t){return 0<=this.indexOf(t)},window.onEnterClick=function(t,e){t.addEventListener("keydown",function(t){13===t.keyCode&&e.click()})},window.elchild=function t(e,a){if(e&&a)if(a.nodeType)e.appendChild(a);else if(a instanceof Array)for(var s=0;s<a.length;s++)t(e,a[s]);else e.appendChild(document.createTextNode(a));return e},window.elclear=function(t){if(t&&t.hasChildNodes())for(;t.hasChildNodes();)t.removeChild(t.firstChild);return t},window.elattr=function(t,e){if(t&&t.nodeType&&e&&e instanceof Object)for(var a in e)t[a]=e[a];return t},window.element=function(t,e,a,s){var n=document.createElement(t);if(elattr(n,e),elchild(n,a),s&&s instanceof Object)for(var i in s)n[i]=s[i];return n},window.table=function(t,e,a,s){for(var n=element("table",a,null,s),i=0;i<t;i++){n.insertRow(-1);for(var o=0;o<e;o++)n.rows[i].insertCell(-1)}return n},window.tblrow=function(t,e,a){for(var s=t.insertRow(-1),n=0;n<e.length;n++)s.insertCell(-1),elchild(s.cells[n],e[n]),elattr(s.cells[n],a[n]);return t},window.TimestampToDateStr=function(t){var e=t?new Date(1e3*t):new Date,a=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),i=e.getHours(),o=e.getMinutes();return s<10&&(s="0"+s),n<10&&(n="0"+n),i<10&&(i="0"+i),o<10&&(o="0"+o),a+"."+s+"."+n+" "+i+":"+o},window.pwdgen=function(t){for(var e,a="abcdefghijklnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&{}()[]=+?*<>;,.:-_",s=[],n="";n.length<t;)e=null,i.random.isReady()?(e=String.fromCharCode(parseInt(i.codec.hex.fromBits(i.random.randomWords(1)).substr(0,2),16)),-1===a.indexOf(e)&&(e=null)):e=a.charAt(Math.floor(Math.random()*a.length)),e&&s.indexOf(e.toLowerCase())<0&&(s.push(e.toLowerCase()),n+=e);return n}},function(t,e,a){"use strict";var s,i=a(0),o=a(2),d=a(1),n=a(13),r=a(14),l=null,c=null,h=null,m=null;l=new n({width:750,title:"Data export",hint:"Here you can get all your data unencrypted.",dom:{},onCreate:function(){this.SetContent(this.dom.text=element("textarea",{className:"export"}))},EventOpen:function(){window.exportData&&setTimeout(function(){for(var t in l.Show(),window.exportData.notes){if(window.exportData.notes[t]instanceof Array&&window.exportData.notes[t].forEach(function(t){var e=i.decode(t.name,!0),a=i.decode(t.data,!0);e&&a&&(l.dom.text.value+=e+": "+a+"\n")}),window.exportData.note_tags[t]instanceof Array){var e=[];window.exportData.note_tags[t].forEach(function(t){window.exportData.tags[t]&&e.push(i.decode(window.exportData.tags[t],!0))}),0<e.length&&(l.dom.text.value+="tags: "+e.join(" ")+"\n")}l.dom.text.value+="\n"}l.dom.text.value=l.dom.text.value.trim(),window.exportData=null},50)},EventClose:function(){l.Close()},controls:{Close:{main:!0,onClick:function(){this.modal.Close()}}}}),c=new n({width:650,title:"Options",hint:"Here you can create/restore backups and export all your data.",onCreate:function(){var e=element("input",{type:"file",name:"file",id:"file-upload",onchange:function(){a.innerHTML=this.value,t.value="File selected"}}),t=element("input",{type:"button",className:"button long",value:"Choose file ...",onclick:function(){e.click()}}),a=element("div",{className:"fhint"});this.SetContent([element("div",{className:"desc"},"Backup is an archived package of all your encrypted data. It can't be read by human but can be used to restore your account info or setup a copy on some other FortNotes instance."),element("input",{type:"button",className:"button long",value:"Create backup",onclick:function(){window.location=d.defaults.server+"user/export/txt"}}),element("div",{className:"desc"},'Please specify your previously downloaded backup package and then press the "Restore backup" button. It will upload your backup to the server and replace all your current data with the data from this backup. Warning: this operation can\'t be reverted!'),element("div",{},[element("input",{type:"button",className:"button long",value:"Restore backup",onclick:function(){var a=this;a.value="Uploading ...",a.disabled=!0;var t=new FormData;t.append("file",e.files[0]),d.postForm("user/import/txt",t,function(t,e){t||(a.value="Restore backup",a.disabled=!1,e&&e.error?alert("Restore from backup failed. Error: "+e.error):(alert("The restore process has completed successfully and now the page will be reloaded to apply the restored data."),window.location.reload()))})}})," ",t,a]),element("div",{className:"desc"},"It's possible to export all the data in a human readable form in order to print it or save in file on some storage. It'll give all the data in plain unencrypted form. The password is required."),element("input",{type:"button",className:"button long",value:"Export data",onclick:function(){var a=this;a.value="Loading ...",a.disabled=!0,d.get("user/export/plain",function(t,e){t||(a.value="Export data",a.disabled=!1,window.exportData=e,i.expirePass())})}})])},EventClose:function(){c.Close()},controls:{Close:{main:!0,onClick:function(){this.modal.Close()}}}}),h=new n({width:500,title:"Password",hint:"Please enter your password to unlock encrypted data.",data:{attempts:0},onCreate:function(){this.data.fldlist=new r({cols:[{className:"colname"},{className:"colvalue"}],attr:{}}),this.data.pass=element("input",{type:"password",autocomplete:"current-password",className:"line"}),this.data.linkset=element("a",{className:"combo",title:"click to change the password storing time"}),onEnterClick(this.data.pass,this.params.controls["Continue"].dom),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"password"),element("br"),element("span",{className:"fldhint"},"your secret key")],[element("input",{type:"text",autocomplete:"username",className:"hidden",value:i.get("username_last_used","")}),this.data.pass]],{}),this.SetContent(element("form",{},this.data.fldlist.dom.table))},onShow:function(){},EventClose:function(){h.Show({escClose:!1})},controls:{"Log off":{main:!1,onClick:function(){this.modal.Close(),Logout()}},Continue:{main:!0,onClick:function(){var t=this.modal,e=t.data.pass.value;i.checkPass(e)?initData(window.dataUser,e,function(){t.data.attempts=0,t.data.pass.value="",t.Close()}):(t.data.pass.focus(),t.data.attempts++,1===t.data.attempts?t.SetMessage("Password is invalid!"):t.SetMessage(["Password is invalid!",element("br"),"Logged attempts: "+t.data.attempts]))}}}}),s=new n({width:500,title:"Authentication",hint:"Welcome back! Please authorize.",data:{attempts:0},onCreate:function(){this.data.fldlist=new r({cols:[{className:"colname"},{className:"colvalue"}],attr:{}}),this.data.name=element("input",{className:"line",autocomplete:"username",type:"text",value:i.get("username_last_used","")}),this.data.pass=element("input",{className:"line",autocomplete:"current-password",type:"password"}),this.data.serv=element("input",{className:"line",autocomplete:"server",type:"url",value:i.get("server","https://fortnotes.com/")}),onEnterClick(this.data.pass,this.params.controls["Login"].dom),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"username"),element("br"),element("span",{className:"fldhint"},"your name or email")],this.data.name],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"password"),element("br"),element("span",{className:"fldhint"},"your secret key")],this.data.pass],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"server"),element("br"),element("span",{className:"fldhint"},"data storage")],this.data.serv],{}),this.SetContent(element("form",{},this.data.fldlist.dom.table))},controls:{Register:{onClick:function(){this.modal.Close(),m.Show({escClose:!1})}},Login:{main:!0,onClick:function(){var a=this.modal,t=a.data.name.value,e=a.data.pass.value;t&&e?(t=o.codec.hex.fromBits(o.hash.sha256.hash(t)),e=o.codec.hex.fromBits(o.hash.sha256.hash(e)),a.EnableControls(!1),a.data.name.disabled=!0,a.data.pass.disabled=!0,1<a.data.attempts&&a.SetLoading("Sending server request ..."),i.set("server",a.data.serv.value,!0),d.defaults.server=a.data.serv.value,d.post("user/auth",{name:t,pass:e,mode:"login"},function(t,e){if(t)a.SetMessage("Request error.","error");else{if(e){if(e&&e.id)return void initData(e,a.data.pass.value,function(){i.set("username_last_used",a.data.name.value,!0),a.data.name.value="",a.data.pass.value="",a.Close()});a.data.attempts++,1===a.data.attempts?a.SetMessage("Invalid user name or password.","error"):a.SetMessage(["Invalid user name or password.",element("br"),"Logged attempts: "+a.data.attempts],"error")}else a.SetMessage("Invalid response from the server.");a.EnableControls(!0),a.data.name.disabled=!1,a.data.pass.disabled=!1}})):a.SetMessage("Empty user name or password.")}}}}),m=new n({width:550,title:"Registration",hint:"You are going to register in the system. Please note that the password you are going to enter will be used not only to login but also to encrypt/decrypt your data so choose a strong and long password. Your registration data won't be sent to the server in plain unencrypted form. Only hashes are stored on the server. We don't know your password and will never ask you to send it to us but at the same time we won't be able to remind it to you so please keep that password utmost safe.",data:{attempts:0},onShow:function(){var a=this;d.get("captcha/uri",function(t,e){t||(e&&e.src?a.data.cimg.src=d.defaults.server+e.src:(a.SetHint("New accounts registration is disabled."),a.SetContent("")))})},onCreate:function(){this.data.fldlist=new r({cols:[{className:"colname"},{className:"colvalue"}],attr:{}}),this.data.name=element("input",{type:"text",autocomplete:"username",className:"line"}),this.data.pass1=element("input",{type:"password",autocomplete:"new-password",className:"line"}),this.data.pass2=element("input",{type:"password",autocomplete:"new-password",className:"line"}),this.data.cimg=element("img",{width:161,height:75}),this.data.code=element("input",{type:"text",autocomplete:"off",className:"line cline",title:"case insensitive code above"}),onEnterClick(this.data.code,this.params.controls["Register"].dom),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"username"),element("br"),element("span",{className:"fldhint"},"your name or email")],this.data.name],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"password"),element("br"),element("span",{className:"fldhint"},"your secret key")],this.data.pass1],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"confirm password"),element("br"),element("span",{className:"fldhint"},"your secret key once more")],this.data.pass2],{}),this.data.fldlist.AddRow([[element("span",{className:"fldname"},"captcha"),element("br"),element("span",{className:"fldwhint"},"enter the code on the image to make sure this is not an automated registration")],[this.data.cimg,element("br"),this.data.code]],{}),this.dom.footer.classList.add("hidden");var e=this;this.SetContent(element("a",{},"I understand that my password can't be restored and will keep it safe",{onclick:function(){var t=document.getElementById("simplemodal-container");e.SetHint("Keep your password safe - you are the only one who knows it so there is no way to restore it!"),t.style.top=parseInt(t.style.top,10)-100+"px",e.SetContent(element("form",{},e.data.fldlist.dom.table)),e.dom.footer.classList.remove("hidden"),e.data.name.focus()}}))},controls:{Cancel:{onClick:function(){this.modal.Close()}},Register:{main:!0,onClick:function(){var t,a=this.modal,e=a.data.name.value,s=a.data.pass1.value,n=a.data.pass2.value;e&&s&&n&&s===n?(e=o.codec.hex.fromBits(o.hash.sha256.hash(e)),t=o.codec.hex.fromBits(o.hash.sha256.hash(s)),a.EnableControls(!1),a.data.name.disabled=!0,a.data.pass1.disabled=!0,a.data.pass2.disabled=!0,1<a.data.attempts&&a.SetLoading("Sending server request ..."),d.post("user/auth",{name:e,pass:t,code:a.data.code.value,mode:"register"},function(t,e){if(t)a.SetMessage("Request error.","error");else{if(e)if(!1!==e.code){if(e&&e.id)return void initData(e,s,function(){i.set("username_last_used",a.data.name.value,!0),a.data.name.value="",a.data.pass1.value="",a.data.pass2.value="",a.Close(),window.pageMain.style.display="block"});a.data.attempts++,1===a.data.attempts?a.SetMessage(["Invalid user name or password.",element("br"),"There maybe already a user with the same name or there are some technical problems on the server."],"error"):a.SetMessage(["Invalid user name or password.",element("br"),"Logged attempts: "+a.data.attempts],"error")}else a.SetMessage("Invalid captcha code. Please correct it and try once again.");else a.SetMessage("Invalid responce from the server.");a.EnableControls(!0),a.data.name.disabled=!1,a.data.pass1.disabled=!1,a.data.pass2.disabled=!1}})):a.SetMessage("Empty one of the required field or passwords don't match.")}}}}),i.subscribe(l),i.subscribe(c),i.subscribe(h),window.DlgExport=l,window.DlgOptions=c,window.DlgPassGet=h,window.DlgUserLogin=s,window.DlgUserRegister=m,t.exports={DlgExport:l,DlgOptions:c,DlgPassGet:h,DlgUserLogin:s,DlgUserRegister:m}},function(t,e,a){"use strict";t.exports=function(t){this.params=t,this.data=t.data||{},this.dom={},this.SetWidth=function(t){this.dom.body.style.width=t+"px"},this.Show=function(t){t=t||{},this.params.onShow&&this.params.onShow instanceof Function&&this.params.onShow.call(this),$(this.dom.main).modal(t)},this.Close=function(t){if(t){var e=this;setTimeout(function(){$.modal.close(),e.Reset()},parseInt(t,10))}else $.modal.close(),this.Reset()},this.Reset=function(){this.SetMessage()},this.SetTitle=function(t){},this.SetHint=function(t){this.dom.hint.style.display=t?(0===this.dom.hint.childNodes.length&&this.dom.hint.appendChild(element("div",{className:"info"},t)),this.dom.hint.childNodes[0].innerHTML=t,""):"none"},this.SetMessage=function(t,e){this.dom.message.style.display=t?(e=e||"warning",elchild(elclear(this.dom.message),element("div",{className:"message "+e},t)),""):"none"},this.SetLoading=function(t){this.SetMessage(t,"loading")},this.SetContent=function(t){t?(elclear(this.dom.content),elchild(this.dom.content,t)):this.dom.content.style.display="none"},this.EnableControls=function(t){if(this.params.controls)for(var e in this.params.controls)this.params.controls[e].dom.disabled=!t},this.Init=function(){if(this.dom.body=element("div",{className:"body"},[this.dom.title=element("div",{className:"block title"},this.params.title),this.dom.hint=element("div",{className:"block hint"}),this.dom.content=element("div",{className:"block content"}),this.dom.message=element("div",{className:"block info"}),this.dom.footer=element("div",{className:"block footer"})]),this.dom.main=element("div",{className:"dialogmodal"},this.dom.body),this.params.width&&this.SetWidth(this.params.width),this.SetHint(this.params.hint),this.SetMessage(this.params.message),this.params.controls)for(var t in this.params.controls){var e=this.params.controls[t];e.dom=element("input",{type:"button",value:t,className:"button"}),e.dom.modal=this,e.main&&(e.dom.className+=" bold"),e.onClick&&e.onClick instanceof Function&&(e.dom.onclick=e.onClick),this.dom.footer.appendChild(e.dom)}this.params.onCreate&&this.params.onCreate instanceof Function&&this.params.onCreate.call(this),this.params.EventClose&&this.params.EventClose instanceof Function&&(this.EventClose=this.params.EventClose),this.params.EventOpen&&this.params.EventOpen instanceof Function&&(this.EventOpen=this.params.EventOpen),this.params.content&&(this.params.content.style.display="",this.dom.content.appendChild(this.params.content))},this.Init()}},function(t,e,a){"use strict";t.exports=function(t){this.params=t,this.dom={},this.SetCols=function(t){this.params.cols=t},this.AddRow=function(t,e){if(t&&t instanceof Array&&t.length===this.params.cols.length){var a=null,s=this.dom.table.insertRow(-1);elattr(s,e);for(var n=0;n<this.params.cols.length;n++)(a=s.insertCell(-1)).className=this.params.cols[n],elchild(a,t[n]),elattr(a,this.params.cols[n]);return s}return!1},this.AddDivider=function(t,e){var a=this.dom.table.insertRow(-1).insertCell(-1);elattr(a,{colspan:this.params.cols.length}),elchild(a,element("div",{className:"divider"}))},this.Init=function(){this.dom.table=element("table",{className:"fldlist"}),elattr(this.dom.table,this.params.attr)},this.Init()}}]);
//# sourceMappingURL=main.js.map